{"version":3,"file":"tonomy-id-sdk.cjs.production.min.js","sources":["../src/services/errors.ts","../src/settings.ts","../src/services/eosio/eosio.ts","../src/services/eosio/transaction.ts","../src/services/keymanager.ts","../src/services/storage.ts","../src/services/username.ts","../src/util/crypto.ts","../src/services/contracts/IDContract.ts","../src/util/top100Passwords.ts","../src/util/passwords.ts","../src/app.ts","../src/util/base64.ts","../src/util/did-jwk.ts","../src/user.ts","../src/util/message.ts","../src/userApps.ts","../src/communication.ts","../src/services/eosio/authority.ts","../src/services/contracts/EosioContract.ts","../src/services/contracts/EosioTokenContract.ts","../src/managers/browserStorage.ts","../src/externalUser.ts","../src/index.ts"],"sourcesContent":["export class HttpError extends Error {\r\n    path: string;\r\n    response: {\r\n        headers: object;\r\n        status: number;\r\n        json?: object;\r\n        html?: string;\r\n        text?: string;\r\n    };\r\n    line?: number;\r\n    column?: number;\r\n    sourceURL?: string;\r\n\r\n    constructor(httpError: HttpError) {\r\n        super('HTTP Error');\r\n        // Ensure the name of this error is the same as the class name\r\n        this.name = this.constructor.name;\r\n\r\n        // This clips the constructor invocation from the stack trace.\r\n        // It's not absolutely essential, but it does make the stack trace a little nicer.\r\n        //  @see Node.js reference (bottom)\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n\r\n        this.stack = new Error().stack;\r\n\r\n        this.path = httpError.path;\r\n        this.response = httpError.response;\r\n        if (httpError.line) this.line = httpError.line;\r\n        if (httpError.column) this.line = httpError.column;\r\n        if (httpError.sourceURL) this.sourceURL = httpError.sourceURL;\r\n    }\r\n}\r\n\r\nexport class SdkError extends Error {\r\n    code: SdkErrors;\r\n\r\n    constructor(message: string) {\r\n        super(message);\r\n        // Ensure the name of this error is the same as the class name\r\n        this.name = this.constructor.name;\r\n\r\n        // This clips the constructor invocation from the stack trace.\r\n        // It's not absolutely essential, but it does make the stack trace a little nicer.\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(this, this.constructor);\r\n        }\r\n\r\n        this.stack = new Error().stack;\r\n    }\r\n}\r\n\r\nexport function createSdkError(message: string, code?: SdkErrors): SdkError {\r\n    let error = new SdkError(message);\r\n\r\n    if (code) {\r\n        error = new SdkError(code + ': ' + message);\r\n        error.code = code;\r\n    }\r\n\r\n    return error;\r\n}\r\n\r\n// using never to suppress error https://bobbyhadz.com/blog/typescript-function-that-throws-error#:~:text=To%20declare%20a%20function%20that,terminate%20execution%20of%20the%20program.\r\nexport function throwError(message: string, code?: SdkErrors): never {\r\n    throw createSdkError(message, code);\r\n}\r\n\r\nenum SdkErrors {\r\n    UsernameTaken = 'UsernameTaken',\r\n    AccountDoesntExist = 'AccountDoesntExist',\r\n    UsernameNotFound = 'UsernameNotFound',\r\n    DataQueryNoRowDataFound = 'DataQueryNoRowDataFound',\r\n    UpdateKeysTransactionNoKeys = 'UpdateKeysTransactionNoKeys',\r\n    CouldntCreateApi = 'CouldntCreateApi',\r\n    PasswordFormatInvalid = 'PasswordFormatInvalid',\r\n    PasswordTooCommon = 'PasswordTooCommon',\r\n    PasswordInValid = 'PasswordInValid',\r\n    KeyNotFound = 'KeyNotFound',\r\n    OriginNotFound = 'OriginNotFound',\r\n    JwtNotValid = 'JwtNotValid',\r\n    WrongOrigin = 'WrongOrigin',\r\n    SettingsNotInitialized = 'SettingsNotInitialized',\r\n    MissingParams = 'MissingParams',\r\n    InvalidKey = 'InvalidKey',\r\n    invalidDataType = 'invalidDataType',\r\n    missingChallenge = 'missingChallenge',\r\n    CommunicationNotConnected = 'CommunicationNotConnected',\r\n    CommunicationTimeout = 'CommunicationTimeout',\r\n    OriginMismatch = 'OriginMismatch',\r\n    PinInValid = 'PinInValid',\r\n    AccountNotFound = 'AccountNotFound',\r\n    UserNotLoggedIn = 'UserNotLoggedIn',\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace SdkErrors {\r\n    /*\r\n     * Returns the index of the enum value\r\n     *\r\n     * @param value The value to get the index of\r\n     */\r\n    export function indexFor(value: SdkErrors): number {\r\n        return Object.keys(SdkErrors).indexOf(value);\r\n    }\r\n\r\n    /*\r\n     * Creates an SdkErrors from a string or index of the level\r\n     *\r\n     * @param value The string or index\r\n     */\r\n    export function from(value: number | string): SdkErrors {\r\n        let index: number;\r\n\r\n        if (typeof value !== 'number') {\r\n            index = SdkErrors.indexFor(value as SdkErrors);\r\n        } else {\r\n            index = value;\r\n        }\r\n\r\n        return Object.values(SdkErrors)[index] as SdkErrors;\r\n    }\r\n}\r\n\r\nexport { SdkErrors };\r\n","import { SdkErrors, throwError } from './services/errors';\r\n\r\nexport type SettingsType = {\r\n    blockchainUrl: string;\r\n    ssoWebsiteOrigin: string;\r\n    accountSuffix: string;\r\n    communicationUrl: string;\r\n};\r\n\r\nlet settings: SettingsType;\r\nlet initialized = false;\r\n\r\nexport function setSettings(newSettings: Partial<SettingsType>) {\r\n    settings = newSettings as SettingsType;\r\n    initialized = true;\r\n}\r\n\r\nexport function getSettings(): SettingsType {\r\n    if (!initialized) {\r\n        throwError('Settings not yet initialized', SdkErrors.SettingsNotInitialized);\r\n    }\r\n    return settings;\r\n}\r\n","import { APIClient, FetchProvider } from '@greymass/eosio';\nimport { GetInfoResponse } from '@greymass/eosio/src/api/v1/types';\nimport fetch from 'cross-fetch';\nimport { getSettings } from '../../settings';\nimport { throwError, SdkErrors } from '../errors';\n\nlet api: APIClient;\n\nexport async function getApi(): Promise<APIClient> {\n    if (api) return api;\n\n    const settings = getSettings();\n\n    api = new APIClient({\n        url: settings.blockchainUrl,\n        provider: new FetchProvider(settings.blockchainUrl, { fetch }),\n    });\n    if (!api) throwError('Could not create API client', SdkErrors.CouldntCreateApi);\n    return api;\n}\n\nexport async function getChainInfo(): Promise<GetInfoResponse> {\n    const api = await getApi();\n\n    return (await api.v1.chain.get_info()) as unknown as GetInfoResponse;\n}\n","import { Action, API, Transaction, SignedTransaction, Signature, Checksum256, Name, PrivateKey } from '@greymass/eosio';\nimport { KeyManager, KeyManagerLevel } from '../keymanager';\nimport { HttpError } from '../errors';\nimport { getApi } from './eosio';\n\ntype ActionData = {\n    authorization: {\n        actor: string;\n        permission: string;\n    }[];\n    account?: string;\n    name: string;\n    data: object;\n};\n\ninterface Signer {\n    sign(digest: Checksum256 | string): Promise<Signature>;\n}\n\ninterface AntelopePushTransactionErrorConstructor extends Error {\n    code: number;\n    error: {\n        code: number;\n        name: string;\n        what: string;\n        details: [\n            {\n                message: string;\n                file: string;\n                line_number: number;\n                method: string;\n            }\n        ];\n    };\n}\n\nfunction createSigner(privateKey: PrivateKey): Signer {\n    return {\n        async sign(digest: Checksum256): Promise<Signature> {\n            return privateKey.signDigest(digest);\n        },\n    };\n}\n\nfunction createKeyManagerSigner(keyManager: KeyManager, level: KeyManagerLevel, challenge?: string): Signer {\n    return {\n        async sign(digest: string | Checksum256): Promise<Signature> {\n            return (await keyManager.signData({\n                level,\n                data: digest,\n                challenge,\n            })) as Signature;\n        },\n    };\n}\n\nexport class AntelopePushTransactionError extends Error {\n    code: number; // HTTP error code\n    message: string; // HTTP error message\n    error: {\n        code: number; // Antelope error code\n        name: string;\n        what: string;\n        details: [\n            {\n                message: string;\n                file: string;\n                line_number: number;\n                method: string;\n            }\n        ];\n    };\n\n    constructor(err: AntelopePushTransactionErrorConstructor) {\n        super('AntelopePushTransactionError');\n\n        this.code = err.code;\n        this.message = err.message;\n        this.error = err.error;\n        this.stack = new Error().stack;\n        // Ensure the name of this error is the same as the class name\n        this.name = this.constructor.name;\n        // This clips the constructor invocation from the stack trace.\n        // It's not absolutely essential, but it does make the stack trace a little nicer.\n        //  @see Node.js reference (bottom)\n\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n\n    hasErrorCode(code: number): boolean {\n        return this.error.code === code;\n    }\n\n    hasTonomyErrorCode(code: string): boolean {\n        // TODO iterate over deatils array instead of only looking at first element\n        return this.error.details[0].message.search(code) > 0;\n    }\n}\n\nasync function transact(\n    contract: Name,\n    actions: ActionData[],\n    signer: Signer\n): Promise<API.v1.PushTransactionResponse> {\n    // Get the ABI\n    const api = await getApi();\n    const abi = await api.v1.chain.get_abi(contract);\n\n    // Create the action data\n    const actionData: Action[] = [];\n\n    actions.forEach((data) => {\n        actionData.push(Action.from({ ...data, account: contract }, abi.abi));\n    });\n\n    // Construct the transaction\n    const info = await api.v1.chain.get_info();\n    const header = info.getTransactionHeader();\n    const transaction = Transaction.from({\n        ...header,\n        actions: actionData,\n    });\n\n    // Create signature\n    const signDigest = transaction.signingDigest(info.chain_id);\n    const signature = await signer.sign(signDigest);\n    const signedTransaction = SignedTransaction.from({\n        ...transaction,\n        signatures: [signature],\n    });\n\n    // Send to the node\n    let res;\n\n    try {\n        res = await api.v1.chain.push_transaction(signedTransaction);\n    } catch (e) {\n        const error = e as any;\n\n        if (error.response && error.response.headers) {\n            if (error.response.json) {\n                throw new AntelopePushTransactionError(error.response.json);\n            }\n\n            throw new HttpError(error);\n        }\n\n        throw e;\n    }\n\n    return res;\n}\n\nexport { transact, Signer, createSigner, createKeyManagerSigner };\n","import { Checksum256, PrivateKey, PublicKey, Signature } from '@greymass/eosio';\r\n\r\nenum KeyManagerLevel {\r\n    PASSWORD = 'PASSWORD',\r\n    PIN = 'PIN',\r\n    FINGERPRINT = 'FINGERPRINT',\r\n    LOCAL = 'LOCAL',\r\n    BROWSER_LOCAL_STORAGE = 'BROWSER_LOCAL_STORAGE',\r\n    BROWSER_SESSION_STORAGE = 'BROWSER_SESSION_STORAGE',\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace KeyManagerLevel {\r\n    /*\r\n     * Returns the index of the enum value\r\n     *\r\n     * @param value The level to get the index of\r\n     */\r\n    export function indexFor(value: KeyManagerLevel): number {\r\n        return Object.keys(KeyManagerLevel).indexOf(value);\r\n    }\r\n\r\n    /*\r\n     * Creates an AuthenticatorLevel from a string or index of the level\r\n     *\r\n     * @param value The string or index\r\n     */\r\n    export function from(value: number | string): KeyManagerLevel {\r\n        let index: number;\r\n\r\n        if (typeof value !== 'number') {\r\n            index = KeyManagerLevel.indexFor(value as KeyManagerLevel);\r\n        } else {\r\n            index = value;\r\n        }\r\n\r\n        return Object.values(KeyManagerLevel)[index] as KeyManagerLevel;\r\n    }\r\n}\r\n\r\n/**\r\n * @param level - The security level of the key\r\n * @param privateKey - The private key to be stored\r\n * @param [challenge] - A challenge that needs to be presented in order for the key to be used\r\n */\r\ntype StoreKeyOptions = {\r\n    level: KeyManagerLevel;\r\n    privateKey: PrivateKey;\r\n    challenge?: string;\r\n};\r\n\r\n/**\r\n * @param level - The security level of the key\r\n * @param data - The data that will be used to create a digital signature\r\n * @param [challenge] - A challenge that needs to be presented in order for the key to be used\r\n */\r\ntype SignDataOptions = {\r\n    level: KeyManagerLevel;\r\n    data: string | Checksum256;\r\n    challenge?: string;\r\n    outputType?: 'jwt' | 'transaction';\r\n};\r\n\r\n/**\r\n * @param level - The security level of the key\r\n */\r\n\r\ntype GetKeyOptions = {\r\n    level: KeyManagerLevel;\r\n};\r\n\r\n/**\r\n * @param level - The security level of the key\r\n * @param challenge - the challenge to check\r\n */\r\ntype CheckKeyOptions = {\r\n    level: KeyManagerLevel;\r\n    challenge: string;\r\n};\r\n\r\ninterface KeyManager {\r\n    /**\r\n     * Stores a private key that can be used later for signing.\r\n     *\r\n     * @remarks\r\n     * Once a private key is stored, it may no longer be accessible.\r\n     *\r\n     * @param options - Options for storing the key\r\n     * @returns The PublicKey\r\n     */\r\n    storeKey(options: StoreKeyOptions): Promise<PublicKey>;\r\n\r\n    /**\r\n     * Signs the hash of data with a stored private key\r\n     *\r\n     * @param options - Options for signing data\r\n     * @returns A digital signature of the SHA256 hashed data\r\n     *\r\n     * @throws if a key does not exist for the level the challenge is incorrect\r\n     */\r\n    signData(options: SignDataOptions): Promise<string | Signature>;\r\n\r\n    /**\r\n     * Returns the public key of a stored private key\r\n     *\r\n     * @param options - Options for retreiving the key\r\n     * @returns The PublicKey or null if no key exists\r\n     */\r\n    getKey(options: GetKeyOptions): Promise<PublicKey | null>;\r\n\r\n    /**\r\n     * @param options - Options for removing a key\r\n     * @throws if a key does not exist for the level\r\n     */\r\n    removeKey(options: GetKeyOptions): Promise<void>;\r\n\r\n    /**\r\n     * generates a random private key\r\n     *\r\n     * @returns The PrivateKey\r\n     */\r\n    generateRandomPrivateKey(): PrivateKey;\r\n\r\n    /**\r\n     * generates a private key from a password and creates random salt\r\n     * @param password password to encrypt the private key with\r\n     * @returns encrypted private key and salt\r\n     *\r\n     */\r\n    generatePrivateKeyFromPassword(\r\n        password: string,\r\n        salt?: Checksum256\r\n    ): Promise<{ privateKey: PrivateKey; salt: Checksum256 }>;\r\n\r\n    /**\r\n     * checks the key against the provided challenge\r\n     * @param {CheckKeyOptions} options - for checking key with level, and challenge\r\n     * @returns {boolean} - returns matching status\r\n     *\r\n     * @throws  if challenge is not provided\r\n     */\r\n    checkKey(options: CheckKeyOptions): Promise<boolean>;\r\n}\r\n\r\nexport { KeyManager, KeyManagerLevel, StoreKeyOptions, SignDataOptions, GetKeyOptions, CheckKeyOptions };\r\n","import { throwError } from './errors';\r\n\r\nexport interface PersistentStorageClean {\r\n    clear: () => Promise<void>;\r\n}\r\n\r\n// TODO make into abstract class which constructs with cache and scope\r\nexport interface PersistentStorage extends PersistentStorageClean {\r\n    [x: string]: any; // this makes sure that the storage can be accessed with any key\r\n    scope: string;\r\n\r\n    /**\r\n     * @param key - The key to store the data under\r\n     * @param data - The data to store\r\n     * @throws {Error} If the data could not be stored\r\n     */\r\n    store(key: string, value: any): Promise<void>;\r\n\r\n    /**\r\n     * @param key - The key to retrieve the data from\r\n     * @returns The data stored under the key\r\n     * @throws {Error} If the data could not be retrieved\r\n     */\r\n    // TODO change to get()?\r\n    retrieve(key: string): Promise<any>;\r\n\r\n    // TODO remove item function\r\n    // remove(key: string): Promise<void>;\r\n\r\n    /**\r\n     * clear all the data stored in the storage\r\n     */\r\n    clear(): Promise<void>;\r\n}\r\n\r\ninterface Storage extends Omit<ProxyHandler<PersistentStorage>, 'set'> {\r\n    set(target: PersistentStorage, key: string, value: any): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * A proxy handler that will create magic getters and setters for the storage\r\n */\r\nexport const storageProxyHandler: Storage = {\r\n    /**\r\n     * return the called property from the storage if it exists\r\n     * @param target - The target object\r\n     * @param key - The property key\r\n     * @returns The value of the property from the storage or cached value\r\n     * @throws {Error} If the data could not be retrieved\r\n     */\r\n    get: (target: PersistentStorage, key: string) => {\r\n        if (key === 'scope') throwError('Scope is a reserved key');\r\n        if (key === 'cache') throwError('Cache is a reserved key');\r\n\r\n        const scopedKey = target.scope + key;\r\n\r\n        if (key in target) {\r\n            if (key === 'clear') {\r\n                target.cache = {};\r\n            }\r\n            return function () {\r\n                target[key]();\r\n            };\r\n        }\r\n        if (target.cache[scopedKey]) return target.cache[scopedKey];\r\n\r\n        return target\r\n            .retrieve(scopedKey)\r\n            .then((data) => {\r\n                target.cache[scopedKey] = data; // cache the data\r\n                return data;\r\n            })\r\n            .catch((e) => {\r\n                throwError(`Could not get ${scopedKey} from storage - ${e}`);\r\n            });\r\n    },\r\n\r\n    /**\r\n     * store the value in the storage\r\n     * @param target - The target object\r\n     * @param key - The property key\r\n     * @param value - The value to store\r\n     * @returns true if the value was stored\r\n     * @throws {Error} If the data could not be stored\r\n     */\r\n    set: async function (target: PersistentStorage, key: string, value: any) {\r\n        const scopedKey = target.scope + key;\r\n\r\n        return target\r\n            .store(scopedKey, value)\r\n            .then(() => {\r\n                target.cache[scopedKey] = value;\r\n                return true;\r\n            })\r\n            .catch(() => {\r\n                return false;\r\n                // throw new Error(`Could not store data - ${e}`);\r\n            });\r\n    },\r\n};\r\n\r\nexport type StorageFactory = (scope: string) => PersistentStorage;\r\n\r\nexport function createStorage<T>(scope: string, storageFactory: StorageFactory): T & PersistentStorageClean {\r\n    const storage = storageFactory(scope);\r\n    storage.cache = {};\r\n    const proxy = new Proxy(storage, storageProxyHandler as any) as any;\r\n\r\n    return proxy as T & PersistentStorageClean;\r\n}\r\n","import { sha256 } from '../util/crypto';\r\n\r\nenum AccountType {\r\n    PERSON = 'PERSON',\r\n    ORG = 'ORG',\r\n    APP = 'APP',\r\n    GOV = 'GOV',\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace AccountType {\r\n    /*\r\n     * Returns the index of the enum value\r\n     *\r\n     * @param value The level to get the index of\r\n     */\r\n    export function indexFor(value: AccountType): number {\r\n        return Object.keys(AccountType).indexOf(value);\r\n    }\r\n\r\n    /*\r\n     * Creates an AccountType from a string or index of the level\r\n     *\r\n     * @param value The string or index\r\n     */\r\n    export function from(value: number | string): AccountType {\r\n        let index: number;\r\n\r\n        if (typeof value !== 'number') {\r\n            index = AccountType.indexFor(value as AccountType);\r\n        } else {\r\n            index = value;\r\n        }\r\n\r\n        return Object.values(AccountType)[index] as AccountType;\r\n    }\r\n\r\n    export function getPreSuffix(value: AccountType): string {\r\n        return value.toLowerCase();\r\n    }\r\n}\r\n\r\nexport { AccountType };\r\n\r\nexport class TonomyUsername {\r\n    username?: string;\r\n    usernameHash: string;\r\n\r\n    constructor(username: string, hashed = false) {\r\n        if (hashed) {\r\n            this.usernameHash = username;\r\n        } else {\r\n            this.username = username;\r\n            this.usernameHash = sha256(this.username);\r\n        }\r\n    }\r\n\r\n    static fromHash(usernameHash: string): TonomyUsername {\r\n        return new TonomyUsername(usernameHash, true);\r\n    }\r\n\r\n    static fromUsername(username: string, type: AccountType, suffix: string) {\r\n        const fullUsername = username + '.' + AccountType.getPreSuffix(type) + suffix;\r\n\r\n        return new TonomyUsername(fullUsername);\r\n    }\r\n\r\n    static fromFullUsername(username: string): TonomyUsername {\r\n        return new TonomyUsername(username);\r\n    }\r\n\r\n    getBaseUsername() {\r\n        return this.username?.split('.')[0];\r\n    }\r\n}\r\n","import { Bytes, Checksum256, KeyType, PrivateKey, PublicKey } from '@greymass/eosio';\nimport rb from '@consento/sync-randombytes';\nimport elliptic from 'elliptic';\nimport { SdkErrors, throwError } from '../services/errors';\nimport { KeyManager, KeyManagerLevel } from '../services/keymanager';\n\nconst secp256k1 = new elliptic.ec('secp256k1');\n\nexport function randomBytes(bytes: number): Uint8Array {\n    return rb(new Uint8Array(bytes));\n}\n\nfunction validateKey(keyPair: elliptic.ec.KeyPair) {\n    const result = keyPair.validate();\n\n    if (!result.result) {\n        throwError(`Key not valid with reason ${result.reason}`, SdkErrors.InvalidKey);\n    }\n}\n\nexport function toElliptic(key: PrivateKey | PublicKey): elliptic.ec.KeyPair {\n    let ecKeyPair: elliptic.ec.KeyPair;\n\n    if (key instanceof PublicKey) {\n        ecKeyPair = secp256k1.keyFromPublic(key.data.array);\n    } else {\n        ecKeyPair = secp256k1.keyFromPrivate(key.data.array);\n    }\n\n    validateKey(ecKeyPair);\n\n    return ecKeyPair;\n}\n\nexport function randomString(bytes: number): string {\n    const random = rb(new Uint8Array(bytes));\n\n    return Array.from(random).map(int2hex).join('');\n}\n\nexport function sha256(digest: string): string {\n    return Checksum256.hash(Bytes.from(encodeHex(digest), 'hex')).toString();\n}\n\nexport function int2hex(i: number) {\n    return ('0' + i.toString(16)).slice(-2);\n}\n\nexport function encodeHex(str: string): string {\n    return str\n        .split('')\n        .map((c) => c.charCodeAt(0).toString(16).padStart(2, '0'))\n        .join('');\n}\n\nexport function decodeHex(hex: string): string {\n    return hex\n        .split(/(\\w\\w)/g)\n        .filter((p) => !!p)\n        .map((c) => String.fromCharCode(parseInt(c, 16)))\n        .join('');\n}\n\nexport function generateRandomKeyPair(): { privateKey: PrivateKey; publicKey: PublicKey } {\n    const bytes = randomBytes(32);\n    const privateKey = new PrivateKey(KeyType.K1, new Bytes(bytes));\n    const publicKey = privateKey.toPublic();\n\n    return { privateKey, publicKey };\n}\n\nexport function createVCSigner(keyManager: KeyManager, level: KeyManagerLevel) {\n    return {\n        async sign(data: string) {\n            return await keyManager.signData({\n                level,\n                data,\n                outputType: 'jwt',\n            });\n        },\n    };\n}\n","/* eslint-disable camelcase */\nimport { API, Checksum256, Name, PublicKey } from '@greymass/eosio';\nimport { TonomyUsername } from '../username';\nimport { getApi } from '../eosio/eosio';\nimport { Signer, transact } from '../eosio/transaction';\nimport { SdkErrors, throwError } from '../errors';\nimport { sha256 } from '../../util/crypto';\n\nenum PermissionLevel {\n    OWNER = 'OWNER',\n    ACTIVE = 'ACTIVE',\n    PASSWORD = 'PASSWORD',\n    PIN = 'PIN',\n    FINGERPRINT = 'FINGERPRINT',\n    LOCAL = 'LOCAL',\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nnamespace PermissionLevel {\n    /*\n     * Returns the index of the enum value\n     *\n     * @param value The value to get the index of\n     */\n    export function indexFor(value: PermissionLevel): number {\n        return Object.keys(PermissionLevel).indexOf(value);\n    }\n\n    /*\n     * Creates an PermissionLevel from a string or index of the level\n     *\n     * @param value The string or index\n     */\n    export function from(value: number | string): PermissionLevel {\n        let index: number;\n\n        if (typeof value !== 'number') {\n            index = PermissionLevel.indexFor(value as PermissionLevel);\n        } else {\n            index = value;\n        }\n\n        return Object.values(PermissionLevel)[index] as PermissionLevel;\n    }\n}\n\ntype GetPersonResponse = {\n    account_name: Name;\n    status: number;\n    username_hash: Checksum256;\n    password_salt: Checksum256;\n    version: number;\n};\n\ntype AppTableRecord = {\n    account_name: Name;\n    app_name: string;\n    username_hash: Checksum256;\n    description: string;\n    logo_url: string;\n    origin: string;\n    version: number;\n};\n\nclass IDContract {\n    static singletonInstance: IDContract;\n\n    public static get Instance() {\n        return this.singletonInstance || (this.singletonInstance = new this());\n    }\n\n    async newperson(\n        username_hash: string,\n        password_key: string,\n        password_salt: string,\n        signer: Signer\n    ): Promise<API.v1.PushTransactionResponse> {\n        const action = {\n            authorization: [\n                {\n                    actor: 'id.tonomy',\n                    permission: 'active',\n                },\n            ],\n            account: 'id.tonomy',\n            name: 'newperson',\n            data: {\n                username_hash,\n                password_key,\n                password_salt,\n            },\n        };\n\n        return await transact(Name.from('id.tonomy'), [action], signer);\n    }\n\n    async updatekeysper(\n        account: string,\n        keys: {\n            FINGERPRINT?: string;\n            PIN?: string;\n            LOCAL?: string;\n        },\n        signer: Signer\n    ): Promise<API.v1.PushTransactionResponse> {\n        const actions = [];\n\n        if (Object.keys(keys).length === 0)\n            throwError('At least one key must be provided', SdkErrors.UpdateKeysTransactionNoKeys);\n\n        for (const key in keys) {\n            const permission = PermissionLevel.from(key);\n\n            // \"keys as any\" fixes typescript issue see https://stackoverflow.com/a/57192972\n            const publicKey = (keys as any)[key];\n\n            actions.push({\n                authorization: [\n                    {\n                        actor: account,\n                        permission: 'active',\n                    },\n                ],\n                account: 'id.tonomy',\n                name: 'updatekeyper',\n                data: {\n                    account,\n                    permission: PermissionLevel.indexFor(permission),\n                    key: publicKey,\n                },\n            });\n        }\n\n        return await transact(Name.from('id.tonomy'), actions, signer);\n    }\n\n    async newapp(\n        app_name: string,\n        description: string,\n        username_hash: string,\n        logo_url: string,\n        origin: string,\n        key: PublicKey,\n        signer: Signer\n    ): Promise<API.v1.PushTransactionResponse> {\n        /^(((http:\\/\\/)|(https:\\/\\/))?)(([a-zA-Z0-9.])+)((:{1}[0-9]+)?)$/g.test(origin);\n        /^(((http:\\/\\/)|(https:\\/\\/))?)(([a-zA-Z0-9.])+)((:{1}[0-9]+)?)([?#/a-zA-Z0-9.]*)$/g.test(logo_url);\n\n        const action = {\n            authorization: [\n                {\n                    actor: 'id.tonomy',\n                    permission: 'active',\n                },\n            ],\n            account: 'id.tonomy',\n            name: 'newapp',\n            data: {\n                app_name,\n                description,\n                logo_url,\n                origin: origin,\n                username_hash,\n                key,\n            },\n        };\n\n        return await transact(Name.from('id.tonomy'), [action], signer);\n    }\n\n    async loginwithapp(\n        account: string,\n        app: string,\n        parent: string,\n        key: PublicKey,\n        signer: Signer\n    ): Promise<API.v1.PushTransactionResponse> {\n        const action = {\n            authorization: [\n                {\n                    actor: account,\n                    permission: parent,\n                },\n            ],\n            account: 'id.tonomy',\n            name: 'loginwithapp',\n            data: {\n                account,\n                app,\n                parent,\n                key,\n            },\n        };\n\n        return await transact(Name.from('id.tonomy'), [action], signer);\n    }\n\n    async getPerson(account: TonomyUsername | Name): Promise<GetPersonResponse> {\n        let data;\n        const api = await getApi();\n\n        if (account instanceof TonomyUsername) {\n            // this is a username\n            const usernameHash = account.usernameHash;\n\n            data = await api.v1.chain.get_table_rows({\n                code: 'id.tonomy',\n                scope: 'id.tonomy',\n                table: 'people',\n                // eslint-disable-next-line camelcase\n                lower_bound: Checksum256.from(usernameHash),\n                limit: 1,\n                // eslint-disable-next-line camelcase\n                index_position: 'secondary',\n            });\n            if (!data || !data.rows) throwError('No data found', SdkErrors.DataQueryNoRowDataFound);\n\n            if (data.rows.length === 0 || data.rows[0].username_hash.toString() !== usernameHash) {\n                throwError('Person with username \"' + account.username + '\" not found', SdkErrors.UsernameNotFound);\n            }\n        } else {\n            // use the account name directly\n            data = await api.v1.chain.get_table_rows({\n                code: 'id.tonomy',\n                scope: 'id.tonomy',\n                table: 'people',\n                // eslint-disable-next-line camelcase\n                lower_bound: account,\n                limit: 1,\n            });\n            if (!data || !data.rows) throwError('No data found', SdkErrors.DataQueryNoRowDataFound);\n\n            if (data.rows.length === 0 || data.rows[0].account_name !== account.toString()) {\n                throwError(\n                    'Person with account name \"' + account.toString() + '\" not found',\n                    SdkErrors.AccountDoesntExist\n                );\n            }\n        }\n\n        const idData = data.rows[0];\n\n        return {\n            // eslint-disable-next-line camelcase\n            account_name: Name.from(idData.account_name),\n            status: idData.status,\n            // eslint-disable-next-line camelcase\n            username_hash: Checksum256.from(idData.username_hash),\n            // eslint-disable-next-line camelcase\n            password_salt: Checksum256.from(idData.password_salt),\n            version: idData.version,\n        };\n    }\n\n    async getApp(account: TonomyUsername | Name | string): Promise<AppTableRecord> {\n        let data;\n        const api = await getApi();\n\n        if (account instanceof TonomyUsername) {\n            // this is a username\n            const usernameHash = account.usernameHash;\n\n            data = await api.v1.chain.get_table_rows({\n                code: 'id.tonomy',\n                scope: 'id.tonomy',\n                table: 'apps',\n                // eslint-disable-next-line camelcase\n                lower_bound: Checksum256.from(usernameHash),\n                limit: 1,\n                // eslint-disable-next-line camelcase\n                index_position: 'secondary',\n            });\n            if (!data || !data.rows) throwError('No data found', SdkErrors.DataQueryNoRowDataFound);\n\n            if (data.rows.length === 0 || data.rows[0].username_hash.toString() !== usernameHash) {\n                throwError('Account with username \"' + account.username + '\" not found', SdkErrors.UsernameNotFound);\n            }\n        } else if (account instanceof Name) {\n            // use the account name directly\n            data = await api.v1.chain.get_table_rows({\n                code: 'id.tonomy',\n                scope: 'id.tonomy',\n                table: 'apps',\n                // eslint-disable-next-line camelcase\n                lower_bound: account,\n                limit: 1,\n            });\n            if (!data || !data.rows) throwError('No data found', SdkErrors.DataQueryNoRowDataFound);\n\n            if (data.rows.length === 0 || data.rows[0].account_name !== account.toString()) {\n                throwError('Account \"' + account.toString() + '\" not found', SdkErrors.AccountDoesntExist);\n            }\n        } else {\n            // account is the origin\n            const origin = account;\n            const originHash = sha256(origin);\n\n            data = await api.v1.chain.get_table_rows({\n                code: 'id.tonomy',\n                scope: 'id.tonomy',\n                table: 'apps',\n                // eslint-disable-next-line camelcase\n                lower_bound: Checksum256.from(originHash),\n                limit: 1,\n                // eslint-disable-next-line camelcase\n                index_position: 'tertiary',\n            });\n            if (!data || !data.rows) throwError('No data found', SdkErrors.DataQueryNoRowDataFound);\n\n            if (data.rows.length === 0 || data.rows[0].origin !== origin) {\n                throwError('Account with origin \"' + origin + '\" not found', SdkErrors.OriginNotFound);\n            }\n        }\n\n        const idData = data.rows[0];\n\n        return {\n            // eslint-disable-next-line camelcase\n            app_name: idData.app_name,\n            description: idData.description,\n            // eslint-disable-next-line camelcase\n            logo_url: idData.logo_url,\n            origin: idData.origin,\n            // eslint-disable-next-line camelcase\n            account_name: Name.from(idData.account_name),\n            // eslint-disable-next-line camelcase\n            username_hash: Checksum256.from(idData.username_hash),\n            version: idData.version,\n        };\n    }\n}\n\nexport { IDContract, GetPersonResponse };\n","// https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/10-million-password-list-top-100.txt\nexport const top100Passwords = [\n    '123456',\n    'password',\n    '12345678',\n    'qwerty',\n    '123456789',\n    '12345',\n    '1234',\n    '111111',\n    '1234567',\n    'dragon',\n    '123123',\n    'baseball',\n    'abc123',\n    'football',\n    'monkey',\n    'letmein',\n    '696969',\n    'shadow',\n    'master',\n    '666666',\n    'qwertyuiop',\n    '123321',\n    'mustang',\n    '1234567890',\n    'michael',\n    '654321',\n    'pussy',\n    'superman',\n    '1qaz2wsx',\n    '7777777',\n    'fuckyou',\n    '121212',\n    //    '0',\n    'qazwsx',\n    '123qwe',\n    'killer',\n    'trustno1',\n    'jordan',\n    'jennifer',\n    'zxcvbnm',\n    'asdfgh',\n    'hunter',\n    'buster',\n    'soccer',\n    'harley',\n    'batman',\n    'andrew',\n    'tigger',\n    'sunshine',\n    'iloveyou',\n    'fuckme',\n    '2000',\n    'charlie',\n    'robert',\n    'thomas',\n    'hockey',\n    'ranger',\n    'daniel',\n    'starwars',\n    'klaster',\n    '112233',\n    'george',\n    'asshole',\n    'computer',\n    'michelle',\n    'jessica',\n    'pepper',\n    '1111',\n    'zxcvbn',\n    '555555',\n    '11111111',\n    '131313',\n    'freedom',\n    '777777',\n    'pass',\n    'fuck',\n    'maggie',\n    '159753',\n    'aaaaaa',\n    'ginger',\n    'princess',\n    'joshua',\n    'cheese',\n    'amanda',\n    'summer',\n    'love',\n    'ashley',\n    '6969',\n    'nicole',\n    'chelsea',\n    'biteme',\n    'matthew',\n    'access',\n    'yankees',\n    '987654321',\n    'dallas',\n    'austin',\n    'thunder',\n    'taylor',\n    'matrix',\n    'minecraft',\n];\n","import { SdkErrors, throwError } from '../services/errors';\r\nimport { top100Passwords } from './top100Passwords';\r\n\r\nexport function validatePassword(masterPassword: string): string {\r\n    const normalizedPassword = masterPassword.normalize('NFKC');\r\n    // minimum 12 characters\r\n    // at least 1 lowercase, 1 uppercase, 1 number\r\n    if (!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{12,}$/.test(normalizedPassword)) {\r\n        throwError('Password is invalid', SdkErrors.PasswordFormatInvalid);\r\n    }\r\n\r\n    for (const password of top100Passwords) {\r\n        if (normalizedPassword.toLowerCase().includes(password))\r\n            throwError('Password contains words or phrases that are too common', SdkErrors.PasswordTooCommon);\r\n    }\r\n\r\n    return normalizedPassword;\r\n}\r\n","/* eslint-disable camelcase */\r\nimport { Name, PrivateKey, PublicKey } from '@greymass/eosio';\r\nimport { IDContract } from './services/contracts/IDContract';\r\nimport { createSigner } from './services/eosio/transaction';\r\nimport { getSettings } from './settings';\r\nimport { AccountType, TonomyUsername } from './services/username';\r\nconst idContract = IDContract.Instance;\r\n\r\nenum AppStatus {\r\n    PENDING = 'PENDING',\r\n    CREATING = 'CREATING',\r\n    READY = 'READY',\r\n    DEACTIVATED = 'DEACTIVATED',\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace AppStatus {\r\n    /*\r\n     * Returns the index of the enum value\r\n     *\r\n     * @param value The level to get the index of\r\n     */\r\n    export function indexFor(value: AppStatus): number {\r\n        return Object.keys(AppStatus).indexOf(value);\r\n    }\r\n\r\n    /*\r\n     * Creates an AppStatus from a string or index of the level\r\n     *\r\n     * @param value The string or index\r\n     */\r\n    export function from(value: number | string): AppStatus {\r\n        let index: number;\r\n        if (typeof value !== 'number') {\r\n            index = AppStatus.indexFor(value as AppStatus);\r\n        } else {\r\n            index = value;\r\n        }\r\n        return Object.values(AppStatus)[index] as AppStatus;\r\n    }\r\n}\r\n\r\nexport { AppStatus };\r\n\r\nexport interface AppData {\r\n    accountName: Name;\r\n    appName: string;\r\n    username: TonomyUsername;\r\n    description: string;\r\n    logoUrl: string;\r\n    origin: string;\r\n    version: number;\r\n    status: AppStatus;\r\n}\r\n\r\nexport type AppCreateOptions = {\r\n    usernamePrefix: string;\r\n    appName: string;\r\n    description: string;\r\n    logoUrl: string;\r\n    origin: string;\r\n    publicKey: PublicKey;\r\n};\r\n\r\nexport class App implements AppData {\r\n    accountName: Name;\r\n    appName: string;\r\n    username: TonomyUsername;\r\n    description: string;\r\n    logoUrl: string;\r\n    origin: string;\r\n    version: number;\r\n    status: AppStatus;\r\n\r\n    constructor(options: AppData) {\r\n        this.accountName = options.accountName;\r\n        this.appName = options.appName;\r\n        this.username = options.username;\r\n        this.description = options.description;\r\n        this.logoUrl = options.logoUrl;\r\n        this.origin = options.origin;\r\n        this.version = options.version;\r\n        this.status = options.status;\r\n    }\r\n\r\n    static async create(options: AppCreateOptions): Promise<App> {\r\n        const username = TonomyUsername.fromUsername(\r\n            options.usernamePrefix,\r\n            AccountType.APP,\r\n            getSettings().accountSuffix\r\n        );\r\n\r\n        // TODO remove this\r\n        const privateKey = PrivateKey.from('PVT_K1_2bfGi9rYsXQSXXTvJbDAPhHLQUojjaNLomdm3cEJ1XTzMqUt3V');\r\n\r\n        const res = await idContract.newapp(\r\n            options.appName,\r\n            options.description,\r\n            username.usernameHash,\r\n            options.logoUrl,\r\n            options.origin,\r\n            options.publicKey,\r\n            createSigner(privateKey)\r\n        );\r\n\r\n        const newAccountAction = res.processed.action_traces[0].inline_traces[0].act;\r\n\r\n        return new App({\r\n            ...options,\r\n            accountName: Name.from(newAccountAction.data.name),\r\n            username,\r\n            version: newAccountAction.data.version,\r\n            status: AppStatus.READY,\r\n        });\r\n    }\r\n\r\n    static async getApp(origin: string): Promise<App> {\r\n        const contractAppData = await idContract.getApp(origin);\r\n\r\n        return new App({\r\n            accountName: contractAppData.account_name,\r\n            appName: contractAppData.app_name,\r\n            username: TonomyUsername.fromHash(contractAppData.username_hash.toString()),\r\n            description: contractAppData.description,\r\n            logoUrl: contractAppData.logo_url,\r\n            origin: contractAppData.origin,\r\n            version: contractAppData.version,\r\n            status: AppStatus.READY,\r\n        });\r\n    }\r\n}\r\n","import { BN } from 'bn.js';\n\n// Inspired by https://github.com/davidchambers/Base64.js/blob/master/base64.js\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst Base64 = {\n    btoa: (input = '') => {\n        const str = input;\n        let output = '';\n\n        for (\n            let block = 0, charCode, i = 0, map = chars;\n            str.charAt(i | 0) || ((map = '='), i % 1);\n            output += map.charAt(63 & (block >> (8 - (i % 1) * 8)))\n        ) {\n            charCode = str.charCodeAt((i += 3 / 4));\n\n            if (charCode > 0xff) {\n                throw new Error(\n                    \"'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.\"\n                );\n            }\n\n            block = (block << 8) | charCode;\n        }\n\n        return output;\n    },\n\n    atob: (input = '') => {\n        const str = input.replace(/=+$/, '');\n        let output = '';\n\n        if (str.length % 4 === 1) {\n            throw new Error(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n        }\n\n        for (\n            let bc = 0, bs = 0, buffer, i = 0;\n            (buffer = str.charAt(i++));\n            ~buffer && ((bs = bc % 4 ? bs * 64 + buffer : buffer), bc++ % 4)\n                ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n                : 0\n        ) {\n            buffer = chars.indexOf(buffer);\n        }\n\n        return output;\n    },\n};\n\n// Polyfill for React Native which does not have Buffer, or atob/btoa\n// TODO maybe do this at global level?\nif (typeof Buffer === 'undefined') {\n    if (typeof window === 'undefined' || typeof window.atob === 'undefined') {\n        window.atob = Base64.atob;\n        window.btoa = Base64.btoa;\n    }\n}\n\nexport function bnToBase64Url(bn: typeof BN): string {\n    if (typeof Buffer !== 'undefined') {\n        // nodejs\n        const buffer = (bn as any).toArrayLike(Buffer, 'be');\n\n        return Buffer.from(buffer).toString('base64');\n    } else {\n        // browser\n        return hexToBase64((bn as any).toString('hex'));\n    }\n}\n\nfunction hexToBase64(hexstring: string) {\n    return window.btoa(\n        (hexstring as any)\n            .match(/\\w{2}/g)\n            .map(function (a: string) {\n                return String.fromCharCode(parseInt(a, 16));\n            })\n            .join('')\n    );\n}\n\nexport function utf8ToB64(str: string) {\n    if (typeof Buffer !== 'undefined') {\n        // nodejs\n        return Buffer.from(str).toString('base64');\n    } else {\n        // browser\n        return window.btoa(unescape(encodeURIComponent(str)));\n    }\n}\n\nexport function b64ToUtf8(str: string) {\n    if (typeof Buffer !== 'undefined') {\n        // nodejs\n        return Buffer.from(str, 'base64').toString('utf8');\n    } else {\n        // browser\n        return decodeURIComponent(escape(window.atob(str)));\n    }\n}\n","import { PublicKey } from '@greymass/eosio';\nimport { toElliptic } from './crypto';\nimport { b64ToUtf8, bnToBase64Url, utf8ToB64 } from './base64';\n\nexport function createJWK(publicKey: PublicKey) {\n    const ecPubKey = toElliptic(publicKey);\n\n    const publicKeyJwk = {\n        crv: 'secp256k1',\n        kty: 'EC',\n        x: bnToBase64Url(ecPubKey.getPublic().getX() as any),\n        y: bnToBase64Url(ecPubKey.getPublic().getY() as any),\n        kid: publicKey.toString(),\n    };\n\n    return publicKeyJwk;\n}\n\n// reference https://github.com/OR13/did-jwk/blob/main/src/index.js#L120\nexport function toDid(jwk: any) {\n    // eslint-disable-next-line no-unused-vars\n    const { d, p, q, dp, dq, qi, ...publicKeyJwk } = jwk;\n    // TODO replace with base64url encoder for web\n    const id = utf8ToB64(JSON.stringify(publicKeyJwk));\n\n    const did = `did:jwk:${id}`;\n\n    return did;\n}\n\n// reference https://github.com/OR13/did-jwk/blob/main/src/index.js#L128\nexport function toDidDocument(jwk: any) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const getPublicOperationsFromPrivate = (keyOps: any) => {\n        if (keyOps.includes('sign')) {\n            return ['verify'];\n        }\n\n        if (keyOps.includes('verify')) {\n            return ['encrypt'];\n        }\n\n        return keyOps;\n    };\n    const {\n        // eslint-disable-next-line no-unused-vars\n        d,\n        p,\n        q,\n        dp,\n        dq,\n        qi,\n\n        // eslint-disable-next-line camelcase\n        key_ops,\n\n        ...publicKeyJwk\n    } = jwk;\n\n    // eslint-disable-next-line camelcase\n    if (d && key_ops) {\n        // eslint-disable-next-line camelcase\n        publicKeyJwk.key_ops = getPublicOperationsFromPrivate(key_ops);\n    }\n\n    const did = toDid(publicKeyJwk);\n    const vm = {\n        id: '#0',\n        type: 'JsonWebKey2020',\n        controller: did,\n        publicKeyJwk,\n    };\n    const didDocument = {\n        '@context': ['https://www.w3.org/ns/did/v1', { '@vocab': 'https://www.iana.org/assignments/jose#' }],\n        id: did,\n        verificationMethod: [vm],\n    };\n\n    return didDocument;\n}\n\n// reference https://github.com/OR13/did-jwk/blob/main/src/index.js#L177\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function resolve(did: any, options = {}) {\n    if (options) options = {};\n    const decoded = b64ToUtf8(did.split(':').pop().split('#')[0]);\n    const jwk = JSON.parse(decoded.toString());\n\n    return toDidDocument(jwk);\n}\n","import { Name, PrivateKey, API, Checksum256 } from '@greymass/eosio';\r\nimport { PushTransactionResponse } from '@greymass/eosio/src/api/v1/types';\r\nimport { KeyManager, KeyManagerLevel } from './services/keymanager';\r\nimport { GetPersonResponse, IDContract } from './services/contracts/IDContract';\r\nimport { AntelopePushTransactionError, createKeyManagerSigner, createSigner } from './services/eosio/transaction';\r\nimport { getApi, getChainInfo } from './services/eosio/eosio';\r\nimport { createStorage, PersistentStorageClean, StorageFactory } from './services/storage';\r\nimport { SdkErrors, throwError, SdkError } from './services/errors';\r\nimport { AccountType, TonomyUsername } from './services/username';\r\nimport { validatePassword } from './util/passwords';\r\nimport { UserApps } from './userApps';\r\nimport { getSettings } from './settings';\r\nimport { Communication } from './communication';\r\nimport { Message } from './util/message';\r\nimport { Issuer } from '@tonomy/did-jwt-vc';\r\nimport { createVCSigner } from './util/crypto';\r\n\r\nenum UserStatus {\r\n    CREATING_ACCOUNT = 'CREATING_ACCOUNT',\r\n    LOGGING_IN = 'LOGGING_IN',\r\n    READY = 'READY',\r\n    DEACTIVATED = 'DEACTIVATED',\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace UserStatus {\r\n    /*\r\n     * Returns the index of the enum value\r\n     *\r\n     * @param value The level to get the index of\r\n     */\r\n    export function indexFor(value: UserStatus): number {\r\n        return Object.keys(UserStatus).indexOf(value);\r\n    }\r\n\r\n    /*\r\n     * Creates an AuthenticatorLevel from a string or index of the level\r\n     *\r\n     * @param value The string or index\r\n     */\r\n    export function from(value: number | string): UserStatus {\r\n        let index: number;\r\n\r\n        if (typeof value !== 'number') {\r\n            index = UserStatus.indexFor(value as UserStatus);\r\n        } else {\r\n            index = value;\r\n        }\r\n\r\n        return Object.values(UserStatus)[index] as UserStatus;\r\n    }\r\n}\r\n\r\nexport { UserStatus };\r\n\r\nexport type UserStorage = {\r\n    status: UserStatus;\r\n    accountName: Name;\r\n    username: TonomyUsername;\r\n    salt: Checksum256;\r\n    did: string;\r\n    // TODO update to have all data from blockchain\r\n};\r\n\r\nconst idContract = IDContract.Instance;\r\n\r\nexport class User {\r\n    private chainID!: Checksum256;\r\n    keyManager: KeyManager;\r\n    storage: UserStorage & PersistentStorageClean;\r\n    apps: UserApps;\r\n    communication: Communication;\r\n\r\n    constructor(_keyManager: KeyManager, storageFactory: StorageFactory) {\r\n        this.keyManager = _keyManager;\r\n        this.storage = createStorage<UserStorage>('tonomy.user.', storageFactory);\r\n\r\n        this.apps = new UserApps(this, _keyManager, storageFactory);\r\n\r\n        //TODO implement dependency inversion\r\n        this.communication = new Communication();\r\n    }\r\n\r\n    async getStatus(): Promise<UserStatus> {\r\n        return await this.storage.status;\r\n    }\r\n\r\n    async getAccountName(): Promise<Name> {\r\n        return await this.storage.accountName;\r\n    }\r\n\r\n    async getUsername(): Promise<TonomyUsername> {\r\n        return await this.storage.username;\r\n    }\r\n\r\n    async getDid(): Promise<string> {\r\n        return await this.storage.did;\r\n    }\r\n\r\n    async saveUsername(username: string) {\r\n        const normalizedUsername = username.normalize('NFKC');\r\n\r\n        let user: API.v1.AccountObject;\r\n        const fullUsername = TonomyUsername.fromUsername(\r\n            normalizedUsername,\r\n            AccountType.PERSON,\r\n            getSettings().accountSuffix\r\n        );\r\n\r\n        try {\r\n            user = (await User.getAccountInfo(fullUsername)) as any; // Throws error if username is taken\r\n            if (user) throwError('Username is taken', SdkErrors.UsernameTaken);\r\n        } catch (e) {\r\n            if (!(e instanceof SdkError && e.code === SdkErrors.UsernameNotFound)) {\r\n                throw e;\r\n            }\r\n        }\r\n\r\n        this.storage.username = fullUsername;\r\n        await this.storage.username;\r\n    }\r\n\r\n    async savePassword(masterPassword: string, options?: { salt?: Checksum256 }) {\r\n        const password = validatePassword(masterPassword);\r\n\r\n        let privateKey: PrivateKey;\r\n        let salt: Checksum256;\r\n\r\n        if (options && options.salt) {\r\n            salt = options.salt;\r\n            const res = await this.keyManager.generatePrivateKeyFromPassword(password, salt);\r\n\r\n            privateKey = res.privateKey;\r\n        } else {\r\n            const res = await this.keyManager.generatePrivateKeyFromPassword(password);\r\n\r\n            privateKey = res.privateKey;\r\n            salt = res.salt;\r\n        }\r\n\r\n        this.storage.salt = salt;\r\n        await this.storage.salt; // wait for magic setter on storage\r\n\r\n        await this.keyManager.storeKey({\r\n            level: KeyManagerLevel.PASSWORD,\r\n            privateKey,\r\n            challenge: password,\r\n        });\r\n    }\r\n\r\n    async savePIN(pin: string) {\r\n        const privateKey = this.keyManager.generateRandomPrivateKey();\r\n\r\n        await this.keyManager.storeKey({\r\n            level: KeyManagerLevel.PIN,\r\n            privateKey,\r\n            challenge: pin,\r\n        });\r\n    }\r\n\r\n    async checkPin(pin: string): Promise<boolean> {\r\n        const pinKey = await this.keyManager.checkKey({\r\n            level: KeyManagerLevel.PIN,\r\n            challenge: pin,\r\n        });\r\n\r\n        if (!pinKey) throwError('Pin is incorrect', SdkErrors.PinInValid);\r\n        return true;\r\n    }\r\n\r\n    async saveFingerprint() {\r\n        const privateKey = this.keyManager.generateRandomPrivateKey();\r\n\r\n        await this.keyManager.storeKey({\r\n            level: KeyManagerLevel.FINGERPRINT,\r\n            privateKey,\r\n        });\r\n    }\r\n\r\n    async saveLocal() {\r\n        const privateKey = this.keyManager.generateRandomPrivateKey();\r\n\r\n        await this.keyManager.storeKey({\r\n            level: KeyManagerLevel.LOCAL,\r\n            privateKey,\r\n        });\r\n    }\r\n\r\n    async createPerson(): Promise<PushTransactionResponse> {\r\n        const { keyManager } = this;\r\n        const username = await this.storage.username;\r\n\r\n        const usernameHash = username.usernameHash;\r\n\r\n        const passwordKey = await keyManager.getKey({\r\n            level: KeyManagerLevel.PASSWORD,\r\n        });\r\n\r\n        if (!passwordKey) throwError('Password key not found', SdkErrors.KeyNotFound);\r\n\r\n        // TODO this needs to change to the actual key used, from settings\r\n        const idTonomyActiveKey = PrivateKey.from('PVT_K1_2bfGi9rYsXQSXXTvJbDAPhHLQUojjaNLomdm3cEJ1XTzMqUt3V');\r\n\r\n        const salt = await this.storage.salt;\r\n        let res: PushTransactionResponse;\r\n\r\n        try {\r\n            res = await idContract.newperson(\r\n                usernameHash.toString(),\r\n                passwordKey.toString(),\r\n                salt.toString(),\r\n                createSigner(idTonomyActiveKey)\r\n            );\r\n        } catch (e) {\r\n            if (e instanceof AntelopePushTransactionError) {\r\n                if (e.hasErrorCode(3050003) && e.hasTonomyErrorCode('TCON1000')) {\r\n                    throw throwError('Username is taken', SdkErrors.UsernameTaken);\r\n                }\r\n            }\r\n\r\n            throw e;\r\n        }\r\n\r\n        const newAccountAction = res.processed.action_traces[0].inline_traces[0].act;\r\n\r\n        this.storage.accountName = Name.from(newAccountAction.data.name);\r\n        await this.storage.accountName;\r\n\r\n        this.storage.status = UserStatus.CREATING_ACCOUNT;\r\n        await this.storage.status;\r\n        await this.createDid();\r\n\r\n        return res;\r\n    }\r\n\r\n    async updateKeys(password: string) {\r\n        const status = await this.getStatus();\r\n\r\n        if (status === UserStatus.DEACTIVATED) {\r\n            throw new Error(\"Can't update keys \");\r\n        }\r\n\r\n        const { keyManager } = this;\r\n\r\n        const pinKey = await keyManager.getKey({ level: KeyManagerLevel.PIN });\r\n        const fingerprintKey = await keyManager.getKey({\r\n            level: KeyManagerLevel.FINGERPRINT,\r\n        });\r\n        const localKey = await keyManager.getKey({ level: KeyManagerLevel.LOCAL });\r\n\r\n        // TODO:\r\n        // use status in smart contract to lock the account till finished creating\r\n        interface KeyInterface {\r\n            PIN: string;\r\n            FINGERPRINT: string;\r\n            LOCAL: string;\r\n        }\r\n\r\n        const keys = {} as KeyInterface;\r\n\r\n        if (pinKey) keys.PIN = pinKey.toString();\r\n        if (fingerprintKey) keys.FINGERPRINT = fingerprintKey.toString();\r\n        if (localKey) keys.LOCAL = localKey.toString();\r\n\r\n        const signer = createKeyManagerSigner(keyManager, KeyManagerLevel.PASSWORD, password);\r\n        const accountName = await this.storage.accountName;\r\n\r\n        await idContract.updatekeysper(accountName.toString(), keys, signer);\r\n        this.storage.status = UserStatus.READY;\r\n        await this.storage.status;\r\n    }\r\n\r\n    async checkPassword(password: string): Promise<boolean> {\r\n        const username = await this.getAccountName();\r\n\r\n        const idData = await idContract.getPerson(username);\r\n        const salt = idData.password_salt;\r\n\r\n        await this.savePassword(password, { salt });\r\n        const passwordKey = await this.keyManager.getKey({\r\n            level: KeyManagerLevel.PASSWORD,\r\n        });\r\n\r\n        const accountData = await User.getAccountInfo(idData.account_name);\r\n        const onchainKey = accountData.getPermission('owner').required_auth.keys[0].key; // TODO change to active/other permissions when we make the change\r\n\r\n        if (!passwordKey) throwError('Password key not found', SdkErrors.KeyNotFound);\r\n\r\n        if (passwordKey.toString() !== onchainKey.toString())\r\n            throwError('Password is incorrect', SdkErrors.PasswordInValid);\r\n\r\n        return true;\r\n    }\r\n\r\n    async login(username: TonomyUsername, password: string): Promise<GetPersonResponse> {\r\n        const { keyManager } = this;\r\n\r\n        const idData = await idContract.getPerson(username);\r\n        const salt = idData.password_salt;\r\n\r\n        await this.savePassword(password, { salt });\r\n        const passwordKey = await keyManager.getKey({\r\n            level: KeyManagerLevel.PASSWORD,\r\n        });\r\n\r\n        if (!passwordKey) throwError('Password key not found', SdkErrors.KeyNotFound);\r\n\r\n        const accountData = await User.getAccountInfo(idData.account_name);\r\n        const onchainKey = accountData.getPermission('owner').required_auth.keys[0].key; // TODO change to active/other permissions when we make the change\r\n\r\n        if (passwordKey.toString() !== onchainKey.toString())\r\n            throwError('Password is incorrect', SdkErrors.PasswordInValid);\r\n\r\n        this.storage.accountName = Name.from(idData.account_name);\r\n        this.storage.username = username;\r\n        this.storage.status = UserStatus.LOGGING_IN;\r\n\r\n        await this.storage.accountName;\r\n        await this.storage.username;\r\n        await this.storage.status;\r\n        await this.createDid();\r\n\r\n        return idData;\r\n    }\r\n\r\n    async checkKeysStillValid(): Promise<boolean> {\r\n        // Account been created, or has not finished being created yet\r\n        if (this.storage.status !== UserStatus.READY) throwError('User is not ready', SdkErrors.AccountDoesntExist);\r\n\r\n        const accountInfo = await User.getAccountInfo(await this.storage.accountName);\r\n\r\n        const checkPairs = [\r\n            {\r\n                level: KeyManagerLevel.PIN,\r\n                permission: 'pin',\r\n            },\r\n            {\r\n                level: KeyManagerLevel.FINGERPRINT,\r\n                permission: 'fingerprint',\r\n            },\r\n            {\r\n                level: KeyManagerLevel.LOCAL,\r\n                permission: 'local',\r\n            },\r\n            {\r\n                level: KeyManagerLevel.PASSWORD,\r\n                permission: 'active',\r\n            },\r\n            {\r\n                level: KeyManagerLevel.PASSWORD,\r\n                permission: 'owner',\r\n            },\r\n        ];\r\n\r\n        for (const pair of checkPairs) {\r\n            let localKey;\r\n\r\n            try {\r\n                localKey = await this.keyManager.getKey({ level: pair.level });\r\n            } catch (e) {\r\n                localKey = null;\r\n            }\r\n\r\n            let blockchainPermission;\r\n\r\n            try {\r\n                blockchainPermission = accountInfo.getPermission(pair.permission);\r\n            } catch (e) {\r\n                blockchainPermission = null;\r\n            }\r\n\r\n            if (!localKey && blockchainPermission) {\r\n                // User probably logged into another device and finished create account flow there\r\n                throwError(\r\n                    `${pair.level} key was not found in the keyManager, but was found on the blockchain`,\r\n                    SdkErrors.KeyNotFound\r\n                );\r\n            }\r\n\r\n            if (localKey && !blockchainPermission) {\r\n                // User probably hasn't finished create account flow yet\r\n                throwError(\r\n                    `${pair.level} keys was not found on the blockchain, but was found in the keyManager`,\r\n                    SdkErrors.KeyNotFound\r\n                );\r\n            }\r\n\r\n            if (\r\n                localKey &&\r\n                blockchainPermission &&\r\n                localKey.toString() !== blockchainPermission.required_auth.keys[0].key.toString()\r\n            ) {\r\n                // User has logged in on another device\r\n                throwError(`${pair.level} keys do not match`, SdkErrors.KeyNotFound);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    async logout(): Promise<void> {\r\n        // remove all keys\r\n        await this.keyManager.removeKey({ level: KeyManagerLevel.PASSWORD });\r\n        await this.keyManager.removeKey({ level: KeyManagerLevel.PIN });\r\n        await this.keyManager.removeKey({ level: KeyManagerLevel.FINGERPRINT });\r\n        await this.keyManager.removeKey({ level: KeyManagerLevel.LOCAL });\r\n        // clear storage data\r\n        this.storage.clear();\r\n\r\n        this.communication.disconnect();\r\n    }\r\n\r\n    async isLoggedIn(): Promise<boolean> {\r\n        return (await this.getStatus()) === UserStatus.READY;\r\n    }\r\n\r\n    static async getAccountInfo(account: TonomyUsername | Name): Promise<API.v1.AccountObject> {\r\n        try {\r\n            let accountName: Name;\r\n            const api = await getApi();\r\n\r\n            if (account instanceof TonomyUsername) {\r\n                const idData = await idContract.getPerson(account);\r\n\r\n                accountName = idData.account_name;\r\n            } else {\r\n                accountName = account;\r\n            }\r\n\r\n            return await api.v1.chain.get_account(accountName);\r\n        } catch (e) {\r\n            const error = e as Error;\r\n\r\n            if (error.message === 'Account not found at /v1/chain/get_account') {\r\n                throwError('Account \"' + account.toString() + '\" not found', SdkErrors.AccountDoesntExist);\r\n            } else {\r\n                throw e;\r\n            }\r\n        }\r\n    }\r\n\r\n    async signMessage(payload: any, recipient?: string): Promise<Message> {\r\n        const signer = createVCSigner(this.keyManager, KeyManagerLevel.LOCAL);\r\n\r\n        const issuer: Issuer = {\r\n            did: (await this.getDid()) + '#local',\r\n            signer: signer.sign as any,\r\n            alg: 'ES256K-R',\r\n        };\r\n\r\n        return await Message.sign(payload, issuer, recipient);\r\n    }\r\n\r\n    /**\r\n     * Generate did in storage\r\n     * @return {string} did string\r\n     */\r\n    async createDid(): Promise<string> {\r\n        if (!this.chainID) {\r\n            this.chainID = (await getChainInfo()).chain_id as unknown as Checksum256;\r\n        }\r\n\r\n        const accountName = await this.storage.accountName;\r\n\r\n        this.storage.did = `did:antelope:${this.chainID}:${accountName.toString()}`;\r\n        await this.storage.did;\r\n        return this.storage.did;\r\n    }\r\n\r\n    async intializeFromStorage() {\r\n        const accountName = await this.getAccountName();\r\n\r\n        if (accountName) {\r\n            return await this.checkKeysStillValid();\r\n        } else {\r\n            throwError('Account \"' + accountName + '\" not found', SdkErrors.AccountDoesntExist);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize and return the user object\r\n * @param keyManager  the key manager\r\n * @param storage  the storage\r\n * @returns the user object\r\n */\r\nexport function createUserObject(keyManager: KeyManager, storageFactory: StorageFactory): User {\r\n    return new User(keyManager, storageFactory);\r\n}\r\n","import { decodeJWT } from '@tonomy/did-jwt';\r\nimport { Issuer, verifyCredential, W3CCredential } from '@tonomy/did-jwt-vc';\r\n\r\n// import { Resolver } from '@tonomy/did-resolver';\r\nimport { getSettings } from '../settings';\r\nimport { JWTDecoded } from '@tonomy/did-jwt/lib/JWT';\r\nimport crossFetch from 'cross-fetch';\r\nimport { getResolver } from '@tonomy/antelope-did-resolver';\r\nimport { Resolver } from '@tonomy/did-resolver';\r\nimport { issue, OutputType } from '@tonomy/antelope-ssi-toolkit';\r\nimport { resolve } from './did-jwk';\r\n\r\nexport class Message {\r\n    private decodedJwt: JWTDecoded;\r\n\r\n    /**\r\n     * creates a signed message and return message object\r\n     * @param message the messageResolver with the signer and the did\r\n     * @param recipient the recipient id\r\n     * @returns a message objects\r\n     */\r\n    static async sign(message: object, issuer: Issuer, recipient?: string): Promise<Message> {\r\n        const vc: W3CCredential = {\r\n            '@context': ['https://www.w3.org/2018/credentials/v1'],\r\n            id: 'https://example.com/id/1234324',\r\n            type: ['VerifiableCredential'],\r\n            issuer: {\r\n                id: issuer.did,\r\n            },\r\n            issuanceDate: new Date().toISOString(),\r\n            credentialSubject: {\r\n                message,\r\n            },\r\n        };\r\n\r\n        // add recipient to vc if given\r\n        if (recipient) vc.credentialSubject.id = recipient;\r\n\r\n        const result = await issue(vc, {\r\n            issuer: issuer,\r\n            outputType: OutputType.JWT,\r\n        });\r\n\r\n        return new Message(result);\r\n    }\r\n\r\n    constructor(public jwt: string) {\r\n        this.decodedJwt = decodeJWT(jwt);\r\n        this.jwt = jwt;\r\n    }\r\n\r\n    // Returns the sender of the message (iss property of the signed VC)\r\n    getSender(): string {\r\n        return this.decodedJwt.payload.iss as string;\r\n    }\r\n    // Returns the recipient of the message (sub property of the signed VC)\r\n    getRecipient(): string {\r\n        return this.decodedJwt.payload.sub as string;\r\n    }\r\n\r\n    // Returns the original unsigned payload\r\n    getPayload(): any {\r\n        return this.decodedJwt.payload.vc.credentialSubject.message;\r\n    }\r\n\r\n    // // Returns the message type (ignores VerifiableCredential type). This is used to determine what kind of message it is (login request, login request confirmation etc...) so the client can choose what to do with it\r\n    // getType(): string {}\r\n\r\n    /* Verifies the VC. True if valid\r\n     * this is setup to resolve did:antelope and did:jwk DIDs\r\n     */\r\n    async verify(): Promise<boolean> {\r\n        const settings = getSettings();\r\n\r\n        //TODO: use compatible resolver for the didjwk resolver\r\n        const jwkResolver: any = {\r\n            resolve,\r\n        };\r\n        // const resolver = {\r\n        //     resolve: new AntelopeDID({ fetch: crossFetch, antelopeChainUrl: settings.blockchainUrl }).resolve,\r\n        // };\r\n        const resolver = new Resolver({\r\n            ...getResolver({ antelopeChainUrl: settings.blockchainUrl, fetch: crossFetch as any }),\r\n        });\r\n\r\n        try {\r\n            const result = await Promise.any([\r\n                verifyCredential(this.jwt, { resolve: jwkResolver.resolve }),\r\n                verifyCredential(this.jwt, resolver),\r\n            ]);\r\n\r\n            return result.verified;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n","/* eslint-disable camelcase */\r\nimport { Name, PublicKey } from '@greymass/eosio';\r\nimport { IDContract } from './services/contracts/IDContract';\r\nimport { KeyManager, KeyManagerLevel } from './services/keymanager';\r\nimport { createStorage, PersistentStorageClean, StorageFactory } from './services/storage';\r\nimport { User } from './user';\r\nimport { createKeyManagerSigner } from './services/eosio/transaction';\r\nimport { SdkErrors, throwError } from './services/errors';\r\nimport { App, AppStatus } from './app';\r\nimport { Message } from './util/message';\r\n\r\nconst idContract = IDContract.Instance;\r\n\r\nexport type UserAppRecord = {\r\n    app: App;\r\n    added: Date;\r\n    status: AppStatus;\r\n};\r\n\r\nexport type UserAppStorage = {\r\n    appRecords: UserAppRecord[];\r\n};\r\n\r\n// TODO change to use VC\r\nexport type JWTLoginPayload = {\r\n    randomString: string;\r\n    origin: string;\r\n    publicKey: string;\r\n    callbackPath?: string;\r\n};\r\n\r\nexport type OnPressLoginOptions = {\r\n    callbackPath: string;\r\n    redirect?: boolean;\r\n};\r\n\r\nexport class UserApps {\r\n    user: User;\r\n    keyManager: KeyManager;\r\n    storage: UserAppStorage & PersistentStorageClean;\r\n\r\n    constructor(_user: User, _keyManager: KeyManager, storageFactory: StorageFactory) {\r\n        this.user = _user;\r\n        this.keyManager = _keyManager;\r\n        this.storage = createStorage<UserAppStorage>('tonomy.user.apps.', storageFactory);\r\n    }\r\n\r\n    async loginWithApp(app: App, key: PublicKey): Promise<void> {\r\n        const myAccount = await this.user.storage.accountName;\r\n\r\n        const appRecord: UserAppRecord = {\r\n            app,\r\n            added: new Date(),\r\n            status: AppStatus.PENDING,\r\n        };\r\n\r\n        let apps = await this.storage.appRecords;\r\n\r\n        if (!apps) {\r\n            apps = [];\r\n        }\r\n\r\n        apps.push(appRecord);\r\n        this.storage.appRecords = apps;\r\n        await this.storage.appRecords;\r\n\r\n        const signer = createKeyManagerSigner(this.keyManager, KeyManagerLevel.LOCAL);\r\n\r\n        await idContract.loginwithapp(myAccount.toString(), app.accountName.toString(), 'local', key, signer);\r\n\r\n        appRecord.status = AppStatus.READY;\r\n        this.storage.appRecords = apps;\r\n        await this.storage.appRecords;\r\n    }\r\n\r\n    /**\r\n     * Verifies the login request are valid requests signed by valid DIDs\r\n     *\r\n     * @param requests {string | null} - a stringified array of JWTs\r\n     * @returns {Promise<Message[]>} - an array of verified messages containing the login requests\r\n     */\r\n    static async verifyRequests(requests: string | null): Promise<Message[]> {\r\n        if (!requests) throwError('No requests found in URL', SdkErrors.MissingParams);\r\n\r\n        const jwtRequests = JSON.parse(requests);\r\n\r\n        if (!jwtRequests || !Array.isArray(jwtRequests) || jwtRequests.length === 0) {\r\n            throwError('No JWTs found in URL', SdkErrors.MissingParams);\r\n        }\r\n\r\n        const verified: Message[] = [];\r\n\r\n        for (const jwt of jwtRequests) {\r\n            verified.push(await this.verifyLoginJWT(jwt));\r\n        }\r\n\r\n        return verified;\r\n    }\r\n\r\n    /**\r\n     * Extracts the login requests, username and accountName from the URL\r\n     *\r\n     * @returns the requests (JWTs), username and accountName\r\n     */\r\n    static getLoginRequestParams(): { requests: string; username: string; accountName: string } {\r\n        const params = new URLSearchParams(window.location.search);\r\n\r\n        const requests = params.get('requests');\r\n\r\n        if (!requests) throwError(\"requests parameter doesn't exists\", SdkErrors.MissingParams);\r\n\r\n        const username = params.get('username');\r\n\r\n        if (!username) throwError(\"username parameter doesn't exists\", SdkErrors.MissingParams);\r\n\r\n        const accountName = params.get('accountName');\r\n\r\n        if (!accountName) throwError(\"accountName parameter doesn't exists\", SdkErrors.MissingParams);\r\n\r\n        return { requests, username, accountName };\r\n    }\r\n\r\n    /**\r\n     * Verifies the login request received in the URL were successfully authorized by Tonomy ID\r\n     *\r\n     * @description should be called in the callback page of the SSO Login website\r\n     *\r\n     * @returns {Promise<Message>} - the verified login request\r\n     */\r\n    static async onRedirectLogin(): Promise<Message> {\r\n        const urlParams = new URLSearchParams(window.location.search);\r\n        const requests = urlParams.get('requests');\r\n\r\n        const verifiedRequests = await UserApps.verifyRequests(requests);\r\n\r\n        const referrer = new URL(document.referrer);\r\n\r\n        for (const message of verifiedRequests) {\r\n            if (message.getPayload().origin === referrer.origin) {\r\n                return message;\r\n            }\r\n        }\r\n\r\n        throwError(\r\n            `No origins from: ${verifiedRequests.map((r) => r.getPayload().origin)} match referrer: ${referrer.origin}`,\r\n            SdkErrors.WrongOrigin\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Checks that a key exists in the key manager that has been authorized on the DID\r\n     *\r\n     * @description This is called on the callback page to verify that the user has logged in correctly\r\n     *\r\n     * @param accountName {string} - the account name to check the key on\r\n     * @param keyManager {KeyManager} - the key manager to check the key in\r\n     * @param keyManagerLevel {KeyManagerLevel=BROWSER_LOCAL_STORAGE} - the level to check the key in\r\n     * @returns {Promise<boolean>} - true if the key exists and is authorized, false otherwise\r\n     */\r\n    static async verifyKeyExistsForApp(\r\n        accountName: string,\r\n        keyManager: KeyManager,\r\n        keyManagerLevel: KeyManagerLevel = KeyManagerLevel.BROWSER_LOCAL_STORAGE\r\n    ): Promise<boolean> {\r\n        const pubKey = await keyManager.getKey({\r\n            level: keyManagerLevel,\r\n        });\r\n\r\n        if (!pubKey) throw throwError('key not found', SdkErrors.KeyNotFound);\r\n        const account = await User.getAccountInfo(Name.from(accountName));\r\n\r\n        if (!account) throwError(\"couldn't fetch account\", SdkErrors.AccountNotFound);\r\n        const app = await App.getApp(window.location.origin);\r\n\r\n        const publickey = account.getPermission(app.accountName).required_auth.keys[0].key;\r\n\r\n        return pubKey.toString() === publickey.toString();\r\n    }\r\n\r\n    /**\r\n     * Verifies a jwt string is a valid message with signature from a DID\r\n     * @param jwt {string} - the jwt string to verify\r\n     * @returns {Promise<Message>} - the verified message\r\n     */\r\n    static async verifyLoginJWT(jwt: string): Promise<Message> {\r\n        const message = new Message(jwt);\r\n        const res = await message.verify();\r\n\r\n        // TODO should check the keys in KeyManager are on the blockchain...\r\n\r\n        if (!res) throwError('JWT failed verification', SdkErrors.JwtNotValid);\r\n        return message;\r\n    }\r\n}\r\n","import { io, Socket } from 'socket.io-client';\r\nimport { createSdkError, SdkErrors } from './services/errors';\r\nimport { getSettings } from './settings';\r\nimport { Message } from './util/message';\r\n\r\nexport type Subscriber = (message: string) => void;\r\n\r\nexport class Communication {\r\n    socketServer: Socket;\r\n\r\n    /**\r\n     * Connects to the Tonomy Communication server\r\n     *\r\n     * @returns {Promise<void>}\r\n     * @throws {SdkError} CommunicationNotConnected\r\n     */\r\n    private async connect(): Promise<void> {\r\n        if (this.socketServer?.connected) return; // dont override socket if connected\r\n        const url = getSettings().communicationUrl;\r\n\r\n        this.socketServer = io(url, {\r\n            transports: ['websocket'],\r\n        });\r\n\r\n        await new Promise((resolve, reject) => {\r\n            this.socketServer.on('connect', () => {\r\n                resolve(true);\r\n                return;\r\n            });\r\n            setTimeout(() => {\r\n                if (this.socketServer.connected) return;\r\n\r\n                reject(\r\n                    createSdkError(\r\n                        'Could not connect to Tonomy Communication server',\r\n                        SdkErrors.CommunicationNotConnected\r\n                    )\r\n                );\r\n            }, 5000);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sends a Message object through a websocket connection to the Tonomy Communication server\r\n     *\r\n     * @param {string} event - the name of the event to emit\r\n     * @param {Message} message - the Message object to send\r\n     * @returns {Promise<boolean>} - true if successful and acknowledged by the server\r\n     * @throws {SdkError} - CommunicationTimeout\r\n     */\r\n    private async emitMessage(event: string, message: Message): Promise<boolean> {\r\n        return await new Promise((resolve, reject) => {\r\n            const resolved = false;\r\n\r\n            this.socketServer.emit(event, { message: message.jwt }, (response: any) => {\r\n                if (response.error) {\r\n                    reject(response);\r\n                }\r\n\r\n                resolve(response);\r\n                return;\r\n            });\r\n            setTimeout(() => {\r\n                if (resolved) return;\r\n                reject(\r\n                    createSdkError(\r\n                        'Connection timed out to Tonomy Communication server',\r\n                        SdkErrors.CommunicationTimeout\r\n                    )\r\n                );\r\n            }, 5000);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * connects to the Tonomy Communication server, authenticates with it's DID\r\n     * subscribes to any messages that are sent by `sendMessage` by providing a callback function executed every time a message is received\r\n     * should send a read receipt when messages are received\r\n     * @returns {boolean} - true if successful\r\n     */\r\n    async login(authorization: Message): Promise<boolean> {\r\n        await this.connect();\r\n\r\n        return await this.emitMessage('login', authorization);\r\n    }\r\n\r\n    /* sends a message to another DID\r\n     * create a Message object from the message argument\r\n     * the message is used as the `vc` property of a VC signed by the User's key\r\n     */\r\n    sendMessage(message: Message): Promise<boolean> {\r\n        return this.emitMessage('message', message);\r\n    }\r\n\r\n    // function that adds a new subscriber, which is called every time a message is received\r\n    subscribeMessage(subscriber: Subscriber): void {\r\n        this.socketServer.on('message', subscriber);\r\n    }\r\n\r\n    // unsubscribes a function from the receiving a message\r\n    unsubscribeMessage(subscriber: Subscriber) {\r\n        this.socketServer.off('message', subscriber);\r\n    }\r\n\r\n    disconnect() {\r\n        if (this.socketServer?.connected) {\r\n            this.socketServer.disconnect();\r\n        }\r\n    }\r\n}\r\n","type KeyWeight = { key: string; weight: number };\r\ntype PermissionWeight = {\r\n    permission: {\r\n        actor: string;\r\n        permission: string;\r\n    };\r\n    weight: number;\r\n};\r\ntype WaitWeight = { wait_sec: number; weight: number };\r\n\r\nclass Authority {\r\n    threshold: number;\r\n\r\n    keys: KeyWeight[];\r\n\r\n    accounts: PermissionWeight[];\r\n\r\n    waits: WaitWeight[];\r\n\r\n    constructor(threshold: number, keys: KeyWeight[], accounts: PermissionWeight[], waits: WaitWeight[]) {\r\n        this.threshold = threshold;\r\n        this.keys = keys;\r\n        this.accounts = accounts;\r\n        this.waits = waits;\r\n    }\r\n\r\n    static fromKey(key: string) {\r\n        const keys = [\r\n            {\r\n                key,\r\n                weight: 1,\r\n            },\r\n        ];\r\n        return new this(1, keys, [], []);\r\n    }\r\n\r\n    static fromAccount(permission: { actor: string; permission: string }) {\r\n        const accounts = [\r\n            {\r\n                permission,\r\n                weight: 1,\r\n            },\r\n        ];\r\n        return new this(1, [], accounts, []);\r\n    }\r\n\r\n    // to add the eosio.code authority for smart contracts\r\n    // https://developers.eos.io/welcome/v2.1/smart-contract-guides/adding-inline-actions#step-1-adding-eosiocode-to-permissions\r\n    addCodePermission(account: string) {\r\n        this.accounts.push({\r\n            permission: {\r\n                actor: account,\r\n                permission: 'eosio.code',\r\n            },\r\n            weight: 1,\r\n        });\r\n    }\r\n}\r\n\r\nexport { Authority };\r\n","/* eslint-disable camelcase */\r\nimport { ABI, API, Name, Serializer } from '@greymass/eosio';\r\nimport { Authority } from '../eosio/authority';\r\nimport { Signer, transact } from '../eosio/transaction';\r\n\r\nclass EosioContract {\r\n    static singletonInstance: EosioContract;\r\n\r\n    public static get Instance() {\r\n        return this.singletonInstance || (this.singletonInstance = new this());\r\n    }\r\n\r\n    /**\r\n     * Deploys a contract at the specified address\r\n     *\r\n     * @param account - Account where the contract will be deployed\r\n     * @param wasmFileContents - wasmFile after reading with fs.readFileSync(path) or equivalent\r\n     * @param abiFileContents - abiFile after reading with fs.readFileSync(path, `utf8`) or equivalent\r\n     */\r\n    async deployContract(\r\n        account: Name,\r\n        wasmFileContent: any,\r\n        abiFileContent: any,\r\n        signer: Signer\r\n    ): Promise<API.v1.PushTransactionResponse> {\r\n        // 1. Prepare SETCODE\r\n        // read the file and make a hex string out of it\r\n        const wasm = wasmFileContent.toString(`hex`);\r\n\r\n        // 2. Prepare SETABI\r\n        const abi = JSON.parse(abiFileContent);\r\n        const abiDef = ABI.from(abi);\r\n        const abiSerializedHex = Serializer.encode({ object: abiDef }).hexString;\r\n\r\n        // 3. Send transaction with both setcode and setabi actions\r\n        const setcodeAction = {\r\n            account: 'eosio',\r\n            name: 'setcode',\r\n            authorization: [\r\n                {\r\n                    actor: account.toString(),\r\n                    permission: 'active',\r\n                },\r\n            ],\r\n            data: {\r\n                account: account.toString(),\r\n                vmtype: 0,\r\n                vmversion: 0,\r\n                code: wasm,\r\n            },\r\n        };\r\n        const setabiAction = {\r\n            account: 'eosio',\r\n            name: 'setabi',\r\n            authorization: [\r\n                {\r\n                    actor: account.toString(),\r\n                    permission: 'active',\r\n                },\r\n            ],\r\n            data: {\r\n                account,\r\n                abi: abiSerializedHex,\r\n            },\r\n        };\r\n        const actions = [setcodeAction, setabiAction];\r\n        return await transact(Name.from('eosio'), actions, signer);\r\n    }\r\n\r\n    async newaccount(\r\n        creator: string,\r\n        account: string,\r\n        owner: Authority,\r\n        active: Authority,\r\n        signer: Signer\r\n    ): Promise<API.v1.PushTransactionResponse> {\r\n        const action = {\r\n            authorization: [\r\n                {\r\n                    actor: creator,\r\n                    permission: 'active',\r\n                },\r\n            ],\r\n            account: 'eosio',\r\n            name: 'newaccount',\r\n            data: {\r\n                creator,\r\n                name: account,\r\n                owner,\r\n                active,\r\n            },\r\n        };\r\n\r\n        return await transact(Name.from('eosio'), [action], signer);\r\n    }\r\n\r\n    async updateauth(\r\n        account: string,\r\n        permission: string,\r\n        parent: string,\r\n        auth: Authority,\r\n        signer: Signer\r\n    ): Promise<API.v1.PushTransactionResponse> {\r\n        const action = {\r\n            authorization: [\r\n                {\r\n                    actor: account,\r\n                    permission: parent, // both parent and permission work as authorization. though permission is supposed to be the authorization that works\r\n                },\r\n            ],\r\n            account: 'eosio',\r\n            name: 'updateauth',\r\n            data: {\r\n                account,\r\n                permission,\r\n                parent,\r\n                auth,\r\n            },\r\n        };\r\n\r\n        return await transact(Name.from('eosio'), [action], signer);\r\n    }\r\n}\r\n\r\nexport { EosioContract };\r\n","/* eslint-disable camelcase */\nimport { API, Name } from '@greymass/eosio';\nimport { Signer, transact } from '../eosio/transaction';\n\nclass EosioTokenContract {\n    static singletonInstande: EosioTokenContract;\n\n    public static get Instance() {\n        return this.singletonInstande || (this.singletonInstande = new this());\n    }\n\n    async create(supply: string, signer: Signer): Promise<API.v1.PushTransactionResponse> {\n        const actions = [\n            {\n                account: 'eosio.token',\n                name: 'create',\n                authorization: [\n                    {\n                        actor: 'eosio.token',\n                        permission: 'active',\n                    },\n                ],\n                data: {\n                    issuer: 'eosio.token',\n                    maximum_supply: supply,\n                },\n            },\n        ];\n\n        return await transact(Name.from('eosio.token'), actions, signer);\n    }\n\n    async issue(quantity: string, signer: Signer): Promise<API.v1.PushTransactionResponse> {\n        const actions = [\n            {\n                account: 'eosio.token',\n                name: 'issue',\n                authorization: [\n                    {\n                        actor: 'eosio.token',\n                        permission: 'active',\n                    },\n                ],\n                data: {\n                    to: 'eosio.token',\n                    quantity,\n                    memo: '',\n                },\n            },\n        ];\n\n        return await transact(Name.from('eosio.token'), actions, signer);\n    }\n}\n\nexport { EosioTokenContract };\n","import { PersistentStorage } from '../services/storage';\r\n\r\nexport class BrowserStorage implements PersistentStorage {\r\n    private _storage: {\r\n        [key in string]: any;\r\n    } = {} as any;\r\n    scope: string;\r\n\r\n    constructor(scope: string) {\r\n        this.scope = scope;\r\n        this._storage = {};\r\n    }\r\n\r\n    async retrieve(key: string): Promise<any> {\r\n        if (key in this._storage) return this._storage[key];\r\n\r\n        if (localStorage) {\r\n            const value = localStorage.getItem(key);\r\n\r\n            if (value) {\r\n                const returnValue = JSON.parse(value);\r\n\r\n                this._storage[key] = returnValue;\r\n                return returnValue;\r\n            }\r\n        } else {\r\n            return undefined;\r\n        }\r\n    }\r\n\r\n    async store(key: string, value: any): Promise<void> {\r\n        if (localStorage) {\r\n            localStorage.setItem(key, JSON.stringify(value));\r\n        }\r\n\r\n        this._storage[key] = value;\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        this._storage = {};\r\n\r\n        if (localStorage) {\r\n            for (let i = 0; i < localStorage.length; i++) {\r\n                const key = localStorage.key(i);\r\n\r\n                if (typeof key === 'string' && key.startsWith(this.scope)) {\r\n                    localStorage.removeItem(key);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function browserStorageFactory(scope: string): PersistentStorage {\r\n    return new BrowserStorage(scope);\r\n}\r\n","import { KeyManager, KeyManagerLevel } from './services/keymanager';\r\nimport { JWTLoginPayload, OnPressLoginOptions, UserApps } from './userApps';\r\nimport { createVCSigner, generateRandomKeyPair, randomString } from './util/crypto';\r\nimport { ES256KSigner } from '@tonomy/did-jwt';\r\nimport { createJWK, toDid } from './util/did-jwk';\r\nimport { Message } from './util/message';\r\nimport { getSettings } from './settings';\r\nimport { SdkErrors, throwError } from './services/errors';\r\nimport { createStorage, PersistentStorageClean, StorageFactory } from './services/storage';\r\nimport { Checksum256, Name } from '@greymass/eosio';\r\nimport { TonomyUsername } from './services/username';\r\nimport { browserStorageFactory } from './managers/browserStorage';\r\nimport { getChainInfo } from './services/eosio/eosio';\r\n\r\nexport type ExternalUserStorage = {\r\n    accountName: Name;\r\n    username: TonomyUsername;\r\n    loginRequest: JWTLoginPayload;\r\n};\r\n\r\nexport type VerifyLoginOptions = {\r\n    checkKeys?: boolean;\r\n    keyManager: KeyManager;\r\n    storageFactory?: StorageFactory;\r\n};\r\n\r\nexport class ExternalUser {\r\n    keyManager: KeyManager;\r\n    storage: ExternalUserStorage & PersistentStorageClean;\r\n    did_: string;\r\n\r\n    /**\r\n     * Creates a new external user\r\n     *\r\n     * @param _keyManager {KeyManager} - the key manager to use for signing\r\n     */\r\n    constructor(_keyManager: KeyManager, _storageFactory: StorageFactory) {\r\n        this.keyManager = _keyManager;\r\n        this.storage = createStorage<ExternalUserStorage>('tonomy.externalUser.', _storageFactory);\r\n    }\r\n\r\n    static async getUser(\r\n        keyManager: KeyManager,\r\n        storageFactory: StorageFactory = browserStorageFactory\r\n    ): Promise<ExternalUser> {\r\n        const user = new ExternalUser(keyManager, storageFactory);\r\n\r\n        try {\r\n            const accountName = await user.getAccountName();\r\n\r\n            if (!accountName) {\r\n                //TODO: logout\r\n                // keyManager.clear(); must be implemented in future keymanager\r\n                throw throwError('accountName not found', SdkErrors.AccountNotFound);\r\n            }\r\n\r\n            const result = await UserApps.verifyKeyExistsForApp(accountName.toString(), keyManager);\r\n\r\n            if (result) {\r\n                return user;\r\n            } else {\r\n                throw throwError('User Not loggedIn', SdkErrors.UserNotLoggedIn);\r\n            }\r\n        } catch (e) {\r\n            //TODO logout\r\n            // keyManager.clear(); must be implemented in future keymanager\r\n            user.storage.clear();\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    async getDid() {\r\n        if (!this.did_) {\r\n            const accountName = await (await this.getAccountName()).toString();\r\n            const chainID = (await getChainInfo()).chain_id as unknown as Checksum256;\r\n\r\n            this.did_ = `did:antelope:${chainID}:${accountName}#local`;\r\n        }\r\n\r\n        return this.did_;\r\n    }\r\n\r\n    /**\r\n     * Sets the account name of the user\r\n     *\r\n     * @param accountName {Name} - the account name of the user\r\n     */\r\n    async setAccountName(accountName: Name): Promise<void> {\r\n        this.storage.accountName = accountName;\r\n        await this.storage.accountName;\r\n    }\r\n\r\n    /**\r\n     * Sets the username of the user\r\n     *\r\n     * @param username {string} - the username of the user\r\n     */\r\n    async setUsername(username: string): Promise<void> {\r\n        this.storage.username = new TonomyUsername(username);\r\n        await this.storage.username;\r\n    }\r\n\r\n    /**\r\n     * Gets the username of the user\r\n     *\r\n     * @returns {Promise<TonomyUsername>} - the username of the user\r\n     */\r\n    async getUsername(): Promise<TonomyUsername> {\r\n        return await this.storage.username;\r\n    }\r\n\r\n    /**\r\n     * Sets the login request\r\n     *\r\n     * @param loginRequest {JWTLoginPayload} - the login request\r\n     */\r\n    async setLoginRequest(loginRequest: JWTLoginPayload): Promise<void> {\r\n        this.storage.loginRequest = loginRequest;\r\n        await this.storage.loginRequest;\r\n    }\r\n\r\n    /**\r\n     * Gets the login request\r\n     *\r\n     * @returns {Promise<JWTLoginPayload>} - the login request\r\n     */\r\n    async getLoginRequest(): Promise<JWTLoginPayload> {\r\n        return await this.storage.loginRequest;\r\n    }\r\n\r\n    /**\r\n     * Gets the account name of the user\r\n     *\r\n     * @returns {Promise<Name>} - the account name of the user\r\n     */\r\n    async getAccountName(): Promise<Name> {\r\n        return await this.storage.accountName;\r\n    }\r\n\r\n    /**\r\n     * Redirects the user to login to the app with their Tonomy ID account\r\n     *\r\n     * @description should be called when the user clicks on the login button\r\n     *\r\n     * @param onPressLoginOptions {OnPressLoginOptions} - options for the login\r\n     * @property onPressLoginOptions.redirect {boolean} - if true, redirects the user to the login page, if false, returns the token\r\n     * @property onPressLoginOptions.callbackPath {string} - the path to redirect the user to after login\r\n     * @param keyManager {KeyManager} - the key manager to use to store the keys\r\n     * @returns {Promise<string | void>} - if redirect is true, returns void, if redirect is false, returns the login request in the form of a JWT token\r\n     */\r\n    static async loginWithTonomy(\r\n        { redirect = true, callbackPath }: OnPressLoginOptions,\r\n        keyManager: KeyManager\r\n    ): Promise<string | void> {\r\n        const { privateKey, publicKey } = generateRandomKeyPair();\r\n\r\n        if (keyManager) {\r\n            await keyManager.storeKey({\r\n                level: KeyManagerLevel.BROWSER_LOCAL_STORAGE,\r\n                privateKey: privateKey,\r\n            });\r\n        }\r\n\r\n        const payload: JWTLoginPayload = {\r\n            randomString: randomString(32),\r\n            origin: window.location.origin,\r\n            publicKey: publicKey.toString(),\r\n            callbackPath,\r\n        };\r\n\r\n        // TODO use expiresIn to make JWT expire after 5 minutes\r\n\r\n        const signer = ES256KSigner(privateKey.data.array, true);\r\n        const jwk = await createJWK(publicKey);\r\n\r\n        const issuer = toDid(jwk);\r\n\r\n        const token = (await Message.sign(payload, { did: issuer, signer: signer as any, alg: 'ES256K-R' })).jwt;\r\n\r\n        const requests = [token];\r\n        const requestsString = JSON.stringify(requests);\r\n\r\n        if (redirect) {\r\n            window.location.href = `${getSettings().ssoWebsiteOrigin}/login?requests=${requestsString}`;\r\n            return;\r\n        }\r\n\r\n        return token;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param [keymanager=JSKEymanager]\r\n     * @throws if user doesn't exists, keys are missing or user not loggedIn\r\n     * @returns the external user object\r\n     */\r\n    //   static getUser(keymanager = JSsKeymanager: KeyManager): Promise<ExternalUser> {\r\n    //  * checks storage for keys and other metadata\r\n    //  * fethces user from blockchain\r\n    //  * checks if user is loggedin by verifying the keys\r\n    //  * delete the keys from storage if they are not verified\r\n    //  * returns the user object\r\n    //  */\r\n    // return Object.assign(this, {})\r\n    //   }\r\n\r\n    /**\r\n     * Signs a message with the given key manager and the key level\r\n     *\r\n     * @param message {any} - an object to sign\r\n     * @param keyManager {KeyManager} - the key manager to use to sign the message\r\n     */\r\n    static async signMessage(message: any, keyManager: KeyManager, recipient?: string): Promise<Message> {\r\n        const keyManagerLevel = KeyManagerLevel.BROWSER_LOCAL_STORAGE;\r\n        const publicKey = await keyManager.getKey({\r\n            level: keyManagerLevel,\r\n        });\r\n\r\n        if (!publicKey) throw throwError('No Key Found for this level', SdkErrors.KeyNotFound);\r\n        const signer = createVCSigner(keyManager, keyManagerLevel).sign;\r\n\r\n        const jwk = await createJWK(publicKey);\r\n\r\n        const issuer = toDid(jwk);\r\n\r\n        return await Message.sign(message, { did: issuer, signer: signer as any, alg: 'ES256K-R' }, recipient);\r\n    }\r\n\r\n    /**\r\n     * Receives the login request from Tonomy ID and verifies the login was successful\r\n     *\r\n     * @description should be called in the callback page\r\n     *\r\n     * @param {options} VerifyLoginOptions - options for the login\r\n     * @property {options.checkKeys} boolean - if true, checks the keys in the keyManager against the blockchain\r\n     * @property {options.keyManager} KeyManager - the key manager to use to storage and manage keys\r\n     * @property {options.storageFactory} [StorageFactory] - the storage factory to use to store data\r\n     *\r\n     * @returns {Promise<ExternalUser>} an external user object ready to use\r\n     */\r\n    static async verifyLoginRequest(options: VerifyLoginOptions): Promise<ExternalUser> {\r\n        if (!options.checkKeys) options.checkKeys = true;\r\n\r\n        const { requests, username, accountName } = UserApps.getLoginRequestParams();\r\n\r\n        const result = await UserApps.verifyRequests(requests);\r\n\r\n        const loginRequest = result.find((r) => r.getPayload().origin === window.location.origin)?.getPayload();\r\n\r\n        if (!loginRequest) throwError('No login request found for this origin', SdkErrors.OriginMismatch);\r\n        if (\r\n            loginRequest.publicKey !==\r\n            (await options.keyManager.getKey({ level: KeyManagerLevel.BROWSER_LOCAL_STORAGE }))?.toString()\r\n        )\r\n            throwError('Key in request does not match', SdkErrors.KeyNotFound);\r\n\r\n        if (options.checkKeys) {\r\n            const keyExists = await UserApps.verifyKeyExistsForApp(accountName, options.keyManager);\r\n\r\n            if (!keyExists) throwError('Key not found', SdkErrors.KeyNotFound);\r\n        }\r\n\r\n        const myStorageFactory = options.storageFactory || browserStorageFactory;\r\n        const externalUser = new ExternalUser(options.keyManager, myStorageFactory);\r\n\r\n        await externalUser.setAccountName(Name.from(accountName));\r\n        await externalUser.setLoginRequest(loginRequest);\r\n        await externalUser.setUsername(username);\r\n        return externalUser;\r\n    }\r\n}\r\n","import * as Eosio from './services/eosio/eosio';\r\nimport * as Transaction from './services/eosio/transaction';\r\n\r\nexport * from './services/keymanager';\r\nexport * from './services/storage';\r\nexport * from './user';\r\nexport * from './userApps';\r\nexport * from './app';\r\n\r\nexport * from './settings';\r\nexport * from './services/eosio/authority';\r\nexport * from './util/crypto';\r\nexport * from './services/username';\r\n\r\nconst EosioUtil = { ...Eosio, ...Transaction };\r\n\r\nexport { EosioUtil };\r\n\r\nexport * from './services/contracts/IDContract';\r\nexport * from './services/contracts/EosioContract';\r\nexport * from './services/contracts/EosioTokenContract';\r\n\r\nexport * from './services/errors';\r\nexport * from './userApps';\r\nexport * from './communication';\r\nexport * from './util/message';\r\nexport * from './externalUser';\r\nexport * from './managers/browserStorage';\r\n\r\nexport { createSigner } from '@tonomy/antelope-ssi-toolkit';\r\nexport { ES256KSigner } from '@tonomy/did-jwt';\r\n"],"names":["SdkErrors","settings","HttpError","_Error","httpError","_this","call","name","constructor","Error","captureStackTrace","_assertThisInitialized","stack","path","response","line","column","sourceURL","_inheritsLoose","_wrapNativeSuper","SdkError","_Error2","message","_this2","createSdkError","code","error","throwError","value","Object","keys","indexOf","index","indexFor","values","api","initialized","getSettings","SettingsNotInitialized","getApi","_getApi","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","abrupt","APIClient","url","blockchainUrl","provider","FetchProvider","fetch","CouldntCreateApi","stop","getChainInfo","_getChainInfo","_callee2","_context2","sent","v1","chain","get_info","createSigner","privateKey","sign","digest","signDigest","createKeyManagerSigner","keyManager","level","challenge","signData","data","AntelopePushTransactionError","err","_proto","prototype","hasErrorCode","this","hasTonomyErrorCode","details","search","transact","_x","_x2","_x3","_transact","_callee3","contract","actions","signer","abi","actionData","info","header","transaction","signedTransaction","res","_context3","get_abi","forEach","push","Action","from","_extends","account","getTransactionHeader","Transaction","signingDigest","chain_id","SignedTransaction","signatures","push_transaction","t0","headers","json","KeyManagerLevel","storageProxyHandler","get","target","key","scopedKey","scope","cache","retrieve","then","e","set","_set","store","createStorage","storageFactory","storage","Proxy","AccountType","secp256k1","elliptic","ec","randomBytes","bytes","rb","Uint8Array","toElliptic","ecKeyPair","result","PublicKey","keyFromPublic","array","keyFromPrivate","validate","reason","InvalidKey","randomString","random","Array","map","int2hex","join","sha256","Checksum256","hash","Bytes","encodeHex","toString","i","slice","str","split","c","charCodeAt","padStart","generateRandomKeyPair","PrivateKey","KeyType","K1","publicKey","toPublic","createVCSigner","outputType","toLowerCase","PermissionLevel","TonomyUsername","username","hashed","usernameHash","fromHash","fromUsername","type","suffix","getPreSuffix","fromFullUsername","getBaseUsername","_this$username","IDContract","newperson","_newperson","username_hash","password_key","password_salt","action","authorization","actor","permission","Name","_x4","updatekeysper","_updatekeysper","length","UpdateKeysTransactionNoKeys","_x5","_x6","_x7","newapp","_newapp","app_name","description","logo_url","origin","test","_x8","_x9","_x10","_x11","_x12","_x13","_x14","loginwithapp","_loginwithapp","_callee4","app","parent","_context4","_x15","_x16","_x17","_x18","_x19","getPerson","_getPerson","_callee5","idData","_context5","get_table_rows","table","lower_bound","limit","index_position","rows","DataQueryNoRowDataFound","UsernameNotFound","account_name","AccountDoesntExist","status","version","_x20","getApp","_getApp","_callee6","originHash","_context6","OriginNotFound","_x21","_createClass","singletonInstance","top100Passwords","validatePassword","masterPassword","normalizedPassword","normalize","PasswordFormatInvalid","_step","_iterator","_createForOfIteratorHelperLoose","done","password","includes","PasswordTooCommon","AppStatus","idContract","Instance","App","options","accountName","appName","logoUrl","create","_create","newAccountAction","usernamePrefix","APP","accountSuffix","processed","action_traces","inline_traces","act","READY","contractAppData","chars","bnToBase64Url","bn","Buffer","buffer","toArrayLike","hexstring","window","btoa","match","a","String","fromCharCode","parseInt","atob","input","replace","output","bc","bs","charAt","charCode","block","createJWK","ecPubKey","crv","kty","x","getPublic","getX","y","getY","kid","toDid","jwk","publicKeyJwk","_objectWithoutPropertiesLoose","_excluded","JSON","stringify","unescape","encodeURIComponent","resolve","did","decoded","pop","decodeURIComponent","escape","keyOps","d","p","key_ops","_excluded2","@context","@vocab","id","verificationMethod","controller","toDidDocument","parse","UserStatus","Message","jwt","decodedJwt","decodeJWT","_sign","issuer","recipient","vc","issuanceDate","Date","toISOString","credentialSubject","issue","OutputType","JWT","getSender","payload","iss","getRecipient","sub","getPayload","verify","_verify","jwkResolver","resolver","Resolver","getResolver","antelopeChainUrl","crossFetch","Promise","any","verifyCredential","verified","UserApps","_user","_keyManager","user","loginWithApp","_loginWithApp","myAccount","appRecord","apps","added","PENDING","appRecords","LOCAL","verifyRequests","_verifyRequests","requests","jwtRequests","MissingParams","isArray","verifyLoginJWT","t1","getLoginRequestParams","params","URLSearchParams","location","onRedirectLogin","_onRedirectLogin","urlParams","verifiedRequests","referrer","_iterator2","_step2","URL","document","r","WrongOrigin","verifyKeyExistsForApp","_verifyKeyExistsForApp","keyManagerLevel","BROWSER_LOCAL_STORAGE","getKey","pubKey","KeyNotFound","User","getAccountInfo","AccountNotFound","publickey","getPermission","required_auth","_verifyLoginJWT","JwtNotValid","Communication","connect","_connect","_this$socketServer","socketServer","connected","communicationUrl","io","transports","reject","on","setTimeout","CommunicationNotConnected","emitMessage","_emitMessage","event","emit","CommunicationTimeout","login","_login","sendMessage","subscribeMessage","subscriber","unsubscribeMessage","off","disconnect","_this$socketServer2","communication","getStatus","_getStatus","getAccountName","_getAccountName","getUsername","_getUsername","getDid","_getDid","saveUsername","_saveUsername","normalizedUsername","fullUsername","PERSON","UsernameTaken","savePassword","_savePassword","salt","_res","generatePrivateKeyFromPassword","storeKey","PASSWORD","savePIN","_savePIN","_callee7","pin","_context7","generateRandomPrivateKey","PIN","checkPin","_checkPin","_callee8","_context8","checkKey","PinInValid","saveFingerprint","_saveFingerprint","_callee9","_context9","FINGERPRINT","saveLocal","_saveLocal","_callee10","_context10","createPerson","_createPerson","_callee11","passwordKey","idTonomyActiveKey","_context11","CREATING_ACCOUNT","createDid","updateKeys","_updateKeys","_callee12","pinKey","fingerprintKey","localKey","_context12","DEACTIVATED","checkPassword","_checkPassword","_callee13","onchainKey","_context13","PasswordInValid","_callee14","_context14","LOGGING_IN","checkKeysStillValid","_checkKeysStillValid","_callee15","accountInfo","checkPairs","_i","_checkPairs","pair","blockchainPermission","_context15","t2","logout","_logout","_callee16","_context16","removeKey","clear","isLoggedIn","_isLoggedIn","_callee17","_context17","_getAccountInfo","_callee18","_context18","get_account","signMessage","_signMessage","_callee19","_context19","alg","_createDid","_callee20","_context20","chainID","intializeFromStorage","_intializeFromStorage","_callee21","_context21","Authority","threshold","accounts","waits","fromKey","weight","fromAccount","addCodePermission","EosioContract","deployContract","_deployContract","wasmFileContent","abiFileContent","wasm","abiDef","abiSerializedHex","setcodeAction","setabiAction","ABI","Serializer","encode","object","hexString","vmtype","vmversion","newaccount","_newaccount","creator","owner","active","updateauth","_updateauth","auth","EosioTokenContract","supply","maximum_supply","_issue","quantity","to","memo","singletonInstande","BrowserStorage","_storage","_retrieve","returnValue","localStorage","getItem","undefined","_store","setItem","_clear","startsWith","removeItem","browserStorageFactory","ExternalUser","_storageFactory","getUser","_getUser","UserNotLoggedIn","did_","setAccountName","_setAccountName","setUsername","_setUsername","setLoginRequest","_setLoginRequest","loginRequest","getLoginRequest","_getLoginRequest","loginWithTonomy","_loginWithTonomy","_ref","_ref$redirect","redirect","callbackPath","_generateRandomKeyPai","token","requestsString","ES256KSigner","href","ssoWebsiteOrigin","verifyLoginRequest","_verifyLoginRequest","_result$find","_yield$options$keyMan","_UserApps$getLoginReq","externalUser","checkKeys","find","OriginMismatch","t3","EosioUtil","Eosio","hex","filter","newSettings"],"mappings":"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"}