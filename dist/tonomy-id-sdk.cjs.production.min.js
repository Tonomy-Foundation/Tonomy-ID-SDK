"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@greymass/eosio"),r=e(require("cross-fetch")),n=e(require("@consento/sync-randombytes")),o=e(require("elliptic")),a=require("@tonomy/did-jwt"),s=require("@tonomy/did-jwt-vc"),i=require("@tonomy/antelope-did-resolver"),u=require("@tonomy/did-resolver"),c=require("@tonomy/antelope-ssi-toolkit"),p=require("socket.io-client");function f(){f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,o){var a=Object.create((t&&t.prototype instanceof l?t:l).prototype),s=new A(o||[]);return n(a,"_invoke",{value:b(e,r,s)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function l(){}function d(){}function v(){}var m={};u(m,a,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(P([])));y&&y!==t&&r.call(y,a)&&(m=y);var x=v.prototype=l.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){var o;n(this,"_invoke",{value:function(n,a){function s(){return new t((function(o,s){!function n(o,a,s,i){var u=p(e[o],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,i)}))}i(u.arg)}(n,a,o,s)}))}return o=o?o.then(s,s):s()}})}function b(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var i=S(s,r);if(i){if(i===h)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=p(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function S(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=p(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=v,n(x,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,i,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},w(k.prototype),u(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var s=new k(c(t,r,n,o),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(x),u(x,i,"Generator"),u(x,a,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=P,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var i=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(i&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),N(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function h(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){h(a,n,o,s,i,"next",e)}function i(e){h(a,n,o,s,i,"throw",e)}s(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}function v(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(){return(m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function g(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,x(e,t)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function k(e,t,r){return(k=w()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&x(o,r.prototype),o}).apply(null,arguments)}function b(e){var t="function"==typeof Map?new Map:void 0;return(b=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),x(r,e)})(e)}function S(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r]);return o}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return N(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var P,O,_=function(e){function t(t){var r;return(r=e.call(this,"HTTP Error")||this).name=r.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(E(r),r.constructor),r.stack=(new Error).stack,r.path=t.path,r.response=t.response,t.line&&(r.line=t.line),t.column&&(r.line=t.column),t.sourceURL&&(r.sourceURL=t.sourceURL),r}return g(t,e),t}(b(Error)),R=function(e){function t(t){var r;return(r=e.call(this,t)||this).name=r.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(E(r),r.constructor),r.stack=(new Error).stack,r}return g(t,e),t}(b(Error));function L(e,t){var r=new R(e);return t&&((r=new R(t+": "+e)).code=t),r}function K(e,t){throw L(e,t)}(P=exports.SdkErrors||(exports.SdkErrors={})).UsernameTaken="UsernameTaken",P.AccountDoesntExist="AccountDoesntExist",P.UsernameNotFound="UsernameNotFound",P.DataQueryNoRowDataFound="DataQueryNoRowDataFound",P.UpdateKeysTransactionNoKeys="UpdateKeysTransactionNoKeys",P.CouldntCreateApi="CouldntCreateApi",P.PasswordFormatInvalid="PasswordFormatInvalid",P.PasswordTooCommon="PasswordTooCommon",P.PasswordInValid="PasswordInValid",P.KeyNotFound="KeyNotFound",P.OriginNotFound="OriginNotFound",P.JwtNotValid="JwtNotValid",P.WrongOrigin="WrongOrigin",P.SettingsNotInitialized="SettingsNotInitialized",P.MissingParams="MissingParams",P.InvalidKey="InvalidKey",P.invalidDataType="invalidDataType",P.missingChallenge="missingChallenge",P.CommunicationNotConnected="CommunicationNotConnected",P.CommunicationTimeout="CommunicationTimeout",P.OriginMismatch="OriginMismatch",P.PinInValid="PinInValid",P.AccountNotFound="AccountNotFound",P.UserNotLoggedIn="UserNotLoggedIn",function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]}}(exports.SdkErrors||(exports.SdkErrors={}));var I,T=!1;function C(){return T||K("Settings not yet initialized",exports.SdkErrors.SettingsNotInitialized),O}function M(){return F.apply(this,arguments)}function F(){return(F=l(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=2;break}return e.abrupt("return",I);case 2:return n=C(),(I=new t.APIClient({url:n.blockchainUrl,provider:new t.FetchProvider(n.blockchainUrl,{fetch:r})}))||K("Could not create API client",exports.SdkErrors.CouldntCreateApi),e.abrupt("return",I);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return D.apply(this,arguments)}function D(){return(D=l(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:return t=e.sent,e.next=5,t.v1.chain.get_info();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U={__proto__:null,getApi:M,getChainInfo:j};function q(e){return{sign:function(t){return l(f().mark((function r(){return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.signDigest(t));case 1:case"end":return r.stop()}}),r)})))()}}}function G(e,t,r){return{sign:function(n){return l(f().mark((function o(){return f().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.signData({level:t,data:n,challenge:r});case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),o)})))()}}}var W=function(e){function t(t){var r;return(r=e.call(this,"AntelopePushTransactionError")||this).code=t.code,r.message=t.message,r.error=t.error,r.stack=(new Error).stack,r.name=r.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(E(r),r.constructor),r}g(t,e);var r=t.prototype;return r.hasErrorCode=function(e){return this.error.code===e},r.hasTonomyErrorCode=function(e){return this.error.details[0].message.search(e)>0},t}(b(Error));function z(e,t,r){return V.apply(this,arguments)}function V(){return(V=l(f().mark((function e(r,n,o){var a,s,i,u,c,p,h,l,d,v;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:return a=e.sent,e.next=5,a.v1.chain.get_abi(r);case 5:return s=e.sent,i=[],n.forEach((function(e){i.push(t.Action.from(m({},e,{account:r}),s.abi))})),e.next=10,a.v1.chain.get_info();case 10:return c=(u=e.sent).getTransactionHeader(),p=t.Transaction.from(m({},c,{actions:i})),h=p.signingDigest(u.chain_id),e.next=16,o.sign(h);case 16:return l=t.SignedTransaction.from(m({},p,{signatures:[e.sent]})),e.prev=18,e.next=21,a.v1.chain.push_transaction(l);case 21:d=e.sent,e.next=32;break;case 24:if(e.prev=24,e.t0=e.catch(18),!(v=e.t0).response||!v.response.headers){e.next=31;break}if(!v.response.json){e.next=30;break}throw new W(v.response.json);case 30:throw new _(v);case 31:throw e.t0;case 32:return e.abrupt("return",d);case 33:case"end":return e.stop()}}),e,null,[[18,24]])})))).apply(this,arguments)}var J,B={__proto__:null,AntelopePushTransactionError:W,transact:z,createSigner:q,createKeyManagerSigner:G};(J=exports.KeyManagerLevel||(exports.KeyManagerLevel={})).PASSWORD="PASSWORD",J.PIN="PIN",J.FINGERPRINT="FINGERPRINT",J.LOCAL="LOCAL",J.BROWSER_LOCAL_STORAGE="BROWSER_LOCAL_STORAGE",J.BROWSER_SESSION_STORAGE="BROWSER_SESSION_STORAGE",function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]}}(exports.KeyManagerLevel||(exports.KeyManagerLevel={}));var H={get:function(e,t){"scope"===t&&K("Scope is a reserved key"),"cache"===t&&K("Cache is a reserved key");var r=e.scope+t;return t in e?("clear"===t&&(e.cache={}),function(){e[t]()}):e.cache[r]?e.cache[r]:e.retrieve(r).then((function(t){return e.cache[r]=t,t})).catch((function(e){K("Could not get "+r+" from storage - "+e)}))},set:function(){var e=l(f().mark((function e(t,r,n){var o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.store(o=t.scope+r,n).then((function(){return t.cache[o]=n,!0})).catch((function(){return!1})));case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()};function Y(e,t){var r=t(e);return r.cache={},new Proxy(r,H)}var Q,X=new o.ec("secp256k1");function Z(e){return n(new Uint8Array(e))}function $(e){var r,n;return(n=(r=e instanceof t.PublicKey?X.keyFromPublic(e.data.array):X.keyFromPrivate(e.data.array)).validate()).result||K("Key not valid with reason "+n.reason,exports.SdkErrors.InvalidKey),r}function ee(e){var t=n(new Uint8Array(e));return Array.from(t).map(re).join("")}function te(e){return t.Checksum256.hash(t.Bytes.from(ne(e),"hex")).toString()}function re(e){return("0"+e.toString(16)).slice(-2)}function ne(e){return e.split("").map((function(e){return e.charCodeAt(0).toString(16).padStart(2,"0")})).join("")}function oe(){var e=Z(32),r=new t.PrivateKey(t.KeyType.K1,new t.Bytes(e)),n=r.toPublic();return{privateKey:r,publicKey:n}}function ae(e,t){return{sign:function(r){return l(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.signData({level:t,data:r,outputType:"jwt"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()}}}(Q=exports.AccountType||(exports.AccountType={})).PERSON="PERSON",Q.ORG="ORG",Q.APP="APP",Q.GOV="GOV",function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]},e.getPreSuffix=function(e){return e.toLowerCase()}}(exports.AccountType||(exports.AccountType={}));var se,ie=function(){function e(e,t){void 0===t&&(t=!1),t?this.usernameHash=e:(this.username=e,this.usernameHash=te(this.username))}return e.fromHash=function(t){return new e(t,!0)},e.fromUsername=function(t,r,n){return new e(t+"."+exports.AccountType.getPreSuffix(r)+n)},e.fromFullUsername=function(t){return new e(t)},e.prototype.getBaseUsername=function(){var e;return null==(e=this.username)?void 0:e.split(".")[0]},e}();!function(e){e.OWNER="OWNER",e.ACTIVE="ACTIVE",e.PASSWORD="PASSWORD",e.PIN="PIN",e.FINGERPRINT="FINGERPRINT",e.LOCAL="LOCAL"}(se||(se={})),function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]}}(se||(se={}));var ue=function(){function e(){}var r=e.prototype;return r.newperson=function(){var e=l(f().mark((function e(r,n,o,a){var s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={authorization:[{actor:"id.tonomy",permission:"active"}],account:"id.tonomy",name:"newperson",data:{username_hash:r,password_key:n,password_salt:o}},e.next=3,z(t.Name.from("id.tonomy"),[s],a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),r.updatekeysper=function(){var e=l(f().mark((function e(r,n,o){var a,s,i,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in a=[],0===Object.keys(n).length&&K("At least one key must be provided",exports.SdkErrors.UpdateKeysTransactionNoKeys),n)i=se.from(s),u=n[s],a.push({authorization:[{actor:r,permission:"active"}],account:"id.tonomy",name:"updatekeyper",data:{account:r,permission:se.indexFor(i),key:u}});return e.next=5,z(t.Name.from("id.tonomy"),a,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),r.newapp=function(){var e=l(f().mark((function e(r,n,o,a,s,i,u){var c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return/^(((http:\/\/)|(https:\/\/))?)(([a-zA-Z0-9.])+)((:{1}[0-9]+)?)$/g.test(s),/^(((http:\/\/)|(https:\/\/))?)(([a-zA-Z0-9.])+)((:{1}[0-9]+)?)([?#/a-zA-Z0-9.]*)$/g.test(a),c={authorization:[{actor:"id.tonomy",permission:"active"}],account:"id.tonomy",name:"newapp",data:{app_name:r,description:n,logo_url:a,origin:s,username_hash:o,key:i}},e.next=5,z(t.Name.from("id.tonomy"),[c],u);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a,s,i){return e.apply(this,arguments)}}(),r.loginwithapp=function(){var e=l(f().mark((function e(r,n,o,a,s){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={authorization:[{actor:r,permission:o}],account:"id.tonomy",name:"loginwithapp",data:{account:r,app:n,parent:o,key:a}},e.next=3,z(t.Name.from("id.tonomy"),[i],s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a){return e.apply(this,arguments)}}(),r.getPerson=function(){var e=l(f().mark((function e(r){var n,o,a,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:if(o=e.sent,!(r instanceof ie)){e.next=12;break}return a=r.usernameHash,e.next=7,o.v1.chain.get_table_rows({code:"id.tonomy",scope:"id.tonomy",table:"people",lower_bound:t.Checksum256.from(a),limit:1,index_position:"secondary"});case 7:(n=e.sent)&&n.rows||K("No data found",exports.SdkErrors.DataQueryNoRowDataFound),0!==n.rows.length&&n.rows[0].username_hash.toString()===a||K('Person with username "'+r.username+'" not found',exports.SdkErrors.UsernameNotFound),e.next=17;break;case 12:return e.next=14,o.v1.chain.get_table_rows({code:"id.tonomy",scope:"id.tonomy",table:"people",lower_bound:r,limit:1});case 14:(n=e.sent)&&n.rows||K("No data found",exports.SdkErrors.DataQueryNoRowDataFound),0!==n.rows.length&&n.rows[0].account_name===r.toString()||K('Person with account name "'+r.toString()+'" not found',exports.SdkErrors.AccountDoesntExist);case 17:return e.abrupt("return",{account_name:t.Name.from((s=n.rows[0]).account_name),status:s.status,username_hash:t.Checksum256.from(s.username_hash),password_salt:t.Checksum256.from(s.password_salt),version:s.version});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.getApp=function(){var e=l(f().mark((function e(r){var n,o,a,s,i,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:if(o=e.sent,!(r instanceof ie)){e.next=12;break}return a=r.usernameHash,e.next=7,o.v1.chain.get_table_rows({code:"id.tonomy",scope:"id.tonomy",table:"apps",lower_bound:t.Checksum256.from(a),limit:1,index_position:"secondary"});case 7:(n=e.sent)&&n.rows||K("No data found",exports.SdkErrors.DataQueryNoRowDataFound),0!==n.rows.length&&n.rows[0].username_hash.toString()===a||K('Account with username "'+r.username+'" not found',exports.SdkErrors.UsernameNotFound),e.next=27;break;case 12:if(!(r instanceof t.Name)){e.next=20;break}return e.next=15,o.v1.chain.get_table_rows({code:"id.tonomy",scope:"id.tonomy",table:"apps",lower_bound:r,limit:1});case 15:(n=e.sent)&&n.rows||K("No data found",exports.SdkErrors.DataQueryNoRowDataFound),0!==n.rows.length&&n.rows[0].account_name===r.toString()||K('Account "'+r.toString()+'" not found',exports.SdkErrors.AccountDoesntExist),e.next=27;break;case 20:return i=te(s=r),e.next=24,o.v1.chain.get_table_rows({code:"id.tonomy",scope:"id.tonomy",table:"apps",lower_bound:t.Checksum256.from(i),limit:1,index_position:"tertiary"});case 24:(n=e.sent)&&n.rows||K("No data found",exports.SdkErrors.DataQueryNoRowDataFound),0!==n.rows.length&&n.rows[0].origin===s||K('Account with origin "'+s+'" not found',exports.SdkErrors.OriginNotFound);case 27:return e.abrupt("return",{app_name:(u=n.rows[0]).app_name,description:u.description,logo_url:u.logo_url,origin:u.origin,account_name:t.Name.from(u.account_name),username_hash:t.Checksum256.from(u.username_hash),version:u.version});case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v(e,null,[{key:"Instance",get:function(){return this.singletonInstance||(this.singletonInstance=new this)}}]),e}(),ce=["123456","password","12345678","qwerty","123456789","12345","1234","111111","1234567","dragon","123123","baseball","abc123","football","monkey","letmein","696969","shadow","master","666666","qwertyuiop","123321","mustang","1234567890","michael","654321","pussy","superman","1qaz2wsx","7777777","fuckyou","121212","qazwsx","123qwe","killer","trustno1","jordan","jennifer","zxcvbnm","asdfgh","hunter","buster","soccer","harley","batman","andrew","tigger","sunshine","iloveyou","fuckme","2000","charlie","robert","thomas","hockey","ranger","daniel","starwars","klaster","112233","george","asshole","computer","michelle","jessica","pepper","1111","zxcvbn","555555","11111111","131313","freedom","777777","pass","fuck","maggie","159753","aaaaaa","ginger","princess","joshua","cheese","amanda","summer","love","ashley","6969","nicole","chelsea","biteme","matthew","access","yankees","987654321","dallas","austin","thunder","taylor","matrix","minecraft"];function pe(e){var t=e.normalize("NFKC");/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{12,}$/.test(t)||K("Password is invalid",exports.SdkErrors.PasswordFormatInvalid);for(var r,n=A(ce);!(r=n()).done;){var o=r.value;t.toLowerCase().includes(o)&&K("Password contains words or phrases that are too common",exports.SdkErrors.PasswordTooCommon)}return t}var fe,he=ue.Instance;(fe=exports.AppStatus||(exports.AppStatus={})).PENDING="PENDING",fe.CREATING="CREATING",fe.READY="READY",fe.DEACTIVATED="DEACTIVATED",function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]}}(exports.AppStatus||(exports.AppStatus={}));var le=function(){function e(e){this.accountName=e.accountName,this.appName=e.appName,this.username=e.username,this.description=e.description,this.logoUrl=e.logoUrl,this.origin=e.origin,this.version=e.version,this.status=e.status}return e.create=function(){var r=l(f().mark((function r(n){var o,a,s;return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=ie.fromUsername(n.usernamePrefix,exports.AccountType.APP,C().accountSuffix),a=t.PrivateKey.from("PVT_K1_2bfGi9rYsXQSXXTvJbDAPhHLQUojjaNLomdm3cEJ1XTzMqUt3V"),r.next=4,he.newapp(n.appName,n.description,o.usernameHash,n.logoUrl,n.origin,n.publicKey,q(a));case 4:return r.abrupt("return",new e(m({},n,{accountName:t.Name.from((s=r.sent.processed.action_traces[0].inline_traces[0].act).data.name),username:o,version:s.data.version,status:exports.AppStatus.READY})));case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),e.getApp=function(){var t=l(f().mark((function t(r){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,he.getApp(r);case 2:return t.abrupt("return",new e({accountName:(n=t.sent).account_name,appName:n.app_name,username:ie.fromHash(n.username_hash.toString()),description:n.description,logoUrl:n.logo_url,origin:n.origin,version:n.version,status:exports.AppStatus.READY}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}(),de="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ve(e){if("undefined"!=typeof Buffer){var t=e.toArrayLike(Buffer,"be");return Buffer.from(t).toString("base64")}return r=e.toString("hex"),window.btoa(r.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""));var r}"undefined"==typeof Buffer&&("undefined"!=typeof window&&void 0!==window.atob||(window.atob=function(e){void 0===e&&(e="");var t=e.replace(/=+$/,""),r="";if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o=0,a=0,s=0;n=t.charAt(s++);~n&&(a=o%4?64*a+n:n,o++%4)?r+=String.fromCharCode(255&a>>(-2*o&6)):0)n=de.indexOf(n);return r},window.btoa=function(e){void 0===e&&(e="");for(var t,r=e,n="",o=0,a=0,s=de;r.charAt(0|a)||(s="=",a%1);n+=s.charAt(63&o>>8-a%1*8)){if((t=r.charCodeAt(a+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|t}return n}));var me=["d","p","q","dp","dq","qi"],ge=["d","p","q","dp","dq","qi","key_ops"];function ye(e){var t=$(e);return{crv:"secp256k1",kty:"EC",x:ve(t.getPublic().getX()),y:ve(t.getPublic().getY()),kid:e.toString()}}function xe(e){var t,r=S(e,me);return"did:jwk:"+(t=JSON.stringify(r),"undefined"!=typeof Buffer?Buffer.from(t).toString("base64"):window.btoa(unescape(encodeURIComponent(t))))}function we(e,t){var r,n=(r=e.split(":").pop().split("#")[0],"undefined"!=typeof Buffer?Buffer.from(r,"base64").toString("utf8"):decodeURIComponent(escape(window.atob(r))));return function(e){var t,r=e.d,n=e.key_ops,o=S(e,ge);r&&n&&(o.key_ops=(t=n).includes("sign")?["verify"]:t.includes("verify")?["encrypt"]:t);var a=xe(o);return{"@context":["https://www.w3.org/ns/did/v1",{"@vocab":"https://www.iana.org/assignments/jose#"}],id:a,verificationMethod:[{id:"#0",type:"JsonWebKey2020",controller:a,publicKeyJwk:o}]}}(JSON.parse(n.toString()))}var ke,be=function(){function e(e){this.jwt=e,this.decodedJwt=a.decodeJWT(e),this.jwt=e}e.sign=function(){var t=l(f().mark((function t(r,n,o){var a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={"@context":["https://www.w3.org/2018/credentials/v1"],id:"https://example.com/id/1234324",type:["VerifiableCredential"],issuer:{id:n.did},issuanceDate:(new Date).toISOString(),credentialSubject:{message:r}},o&&(a.credentialSubject.id=o),t.next=4,c.issue(a,{issuer:n,outputType:c.OutputType.JWT});case 4:return t.abrupt("return",new e(t.sent));case 6:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}();var t=e.prototype;return t.getSender=function(){return this.decodedJwt.payload.iss},t.getRecipient=function(){return this.decodedJwt.payload.sub},t.getPayload=function(){return this.decodedJwt.payload.vc.credentialSubject.message},t.verify=function(){var e=l(f().mark((function e(){var t,n,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=C(),n={resolve:we},o=new u.Resolver(m({},i.getResolver({antelopeChainUrl:t.blockchainUrl,fetch:r}))),e.prev=3,e.next=6,Promise.any([s.verifyCredential(this.jwt,{resolve:n.resolve}),s.verifyCredential(this.jwt,o)]);case 6:return e.abrupt("return",e.sent.verified);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),e}(),Se=ue.Instance,Ee=function(){function e(e,t,r){this.user=e,this.keyManager=t,this.storage=Y("tonomy.user.apps.",r)}return e.prototype.loginWithApp=function(){var e=l(f().mark((function e(t,r){var n,o,a,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.user.storage.accountName;case 2:return n=e.sent,o={app:t,added:new Date,status:exports.AppStatus.PENDING},e.next=6,this.storage.appRecords;case 6:return(a=e.sent)||(a=[]),a.push(o),this.storage.appRecords=a,e.next=12,this.storage.appRecords;case 12:return s=G(this.keyManager,exports.KeyManagerLevel.LOCAL),e.next=15,Se.loginwithapp(n.toString(),t.accountName.toString(),"local",r,s);case 15:return o.status=exports.AppStatus.READY,this.storage.appRecords=a,e.next=19,this.storage.appRecords;case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),e.verifyRequests=function(){var e=l(f().mark((function e(t){var r,n,o,a,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t||K("No requests found in URL",exports.SdkErrors.MissingParams),(r=JSON.parse(t))&&Array.isArray(r)&&0!==r.length||K("No JWTs found in URL",exports.SdkErrors.MissingParams),n=[],o=A(r);case 5:if((a=o()).done){e.next=14;break}return s=a.value,e.t0=n,e.next=10,this.verifyLoginJWT(s);case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 12:e.next=5;break;case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e.getLoginRequestParams=function(){var e=new URLSearchParams(window.location.search),t=e.get("requests");t||K("requests parameter doesn't exists",exports.SdkErrors.MissingParams);var r=e.get("username");r||K("username parameter doesn't exists",exports.SdkErrors.MissingParams);var n=e.get("accountName");return n||K("accountName parameter doesn't exists",exports.SdkErrors.MissingParams),{requests:t,username:r,accountName:n}},e.onRedirectLogin=function(){var t=l(f().mark((function t(){var r,n,o,a,s,i,u;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new URLSearchParams(window.location.search),n=r.get("requests"),t.next=4,e.verifyRequests(n);case 4:o=t.sent,a=new URL(document.referrer),s=A(o);case 7:if((i=s()).done){t.next=13;break}if((u=i.value).getPayload().origin!==a.origin){t.next=11;break}return t.abrupt("return",u);case 11:t.next=7;break;case 13:K("No origins from: "+o.map((function(e){return e.getPayload().origin}))+" match referrer: "+a.origin,exports.SdkErrors.WrongOrigin);case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),e.verifyKeyExistsForApp=function(){var e=l(f().mark((function e(r,n,o){var a,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===o&&(o=exports.KeyManagerLevel.BROWSER_LOCAL_STORAGE),e.next=3,n.getKey({level:o});case 3:if(a=e.sent){e.next=6;break}throw K("key not found",exports.SdkErrors.KeyNotFound);case 6:return e.next=8,Pe.getAccountInfo(t.Name.from(r));case 8:return(s=e.sent)||K("couldn't fetch account",exports.SdkErrors.AccountNotFound),e.next=12,le.getApp(window.location.origin);case 12:return i=s.getPermission(e.sent.accountName).required_auth.keys[0].key,e.abrupt("return",a.toString()===i.toString());case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),e.verifyLoginJWT=function(){var e=l(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new be(t),e.next=3,r.verify();case 3:return e.sent||K("JWT failed verification",exports.SdkErrors.JwtNotValid),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e}(),Ne=function(){function e(){}var t=e.prototype;return t.connect=function(){var e=l(f().mark((function e(){var t,r,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this.socketServer)||!t.connected){e.next=2;break}return e.abrupt("return");case 2:return r=C().communicationUrl,this.socketServer=p.io(r,{transports:["websocket"]}),e.next=6,new Promise((function(e,t){n.socketServer.on("connect",(function(){e(!0)})),setTimeout((function(){n.socketServer.connected||t(L("Could not connect to Tonomy Communication server",exports.SdkErrors.CommunicationNotConnected))}),5e3)}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.emitMessage=function(){var e=l(f().mark((function e(t,r){var n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,o){n.socketServer.emit(t,{message:r.jwt},(function(t){t.error&&o(t),e(t)})),setTimeout((function(){o(L("Connection timed out to Tonomy Communication server",exports.SdkErrors.CommunicationTimeout))}),5e3)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.login=function(){var e=l(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connect();case 2:return e.next=4,this.emitMessage("login",t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.sendMessage=function(e){return this.emitMessage("message",e)},t.subscribeMessage=function(e){this.socketServer.on("message",e)},t.unsubscribeMessage=function(e){this.socketServer.off("message",e)},t.disconnect=function(){var e;null!=(e=this.socketServer)&&e.connected&&this.socketServer.disconnect()},e}();(ke=exports.UserStatus||(exports.UserStatus={})).CREATING_ACCOUNT="CREATING_ACCOUNT",ke.LOGGING_IN="LOGGING_IN",ke.READY="READY",ke.DEACTIVATED="DEACTIVATED",function(e){e.indexFor=function(t){return Object.keys(e).indexOf(t)},e.from=function(t){var r;return r="number"!=typeof t?e.indexFor(t):t,Object.values(e)[r]}}(exports.UserStatus||(exports.UserStatus={}));var Ae=ue.Instance,Pe=function(){function e(e,t){this.keyManager=e,this.storage=Y("tonomy.user.",t),this.apps=new Ee(this,e,t),this.communication=new Ne}var r=e.prototype;return r.getStatus=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.status;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getAccountName=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.accountName;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getUsername=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.username;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getDid=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.did;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.saveUsername=function(){var t=l(f().mark((function t(r){var n,o;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.normalize("NFKC"),o=ie.fromUsername(n,exports.AccountType.PERSON,C().accountSuffix),t.prev=2,t.next=5,e.getAccountInfo(o);case 5:t.sent&&K("Username is taken",exports.SdkErrors.UsernameTaken),t.next=13;break;case 9:if(t.prev=9,t.t0=t.catch(2),t.t0 instanceof R&&t.t0.code===exports.SdkErrors.UsernameNotFound){t.next=13;break}throw t.t0;case 13:return this.storage.username=o,t.next=16,this.storage.username;case 16:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),r.savePassword=function(){var e=l(f().mark((function e(t,r){var n,o,a,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=pe(t),!r||!r.salt){e.next=9;break}return a=r.salt,e.next=5,this.keyManager.generatePrivateKeyFromPassword(n,a);case 5:o=e.sent.privateKey,e.next=14;break;case 9:return e.next=11,this.keyManager.generatePrivateKeyFromPassword(n);case 11:o=(s=e.sent).privateKey,a=s.salt;case 14:return this.storage.salt=a,e.next=17,this.storage.salt;case 17:return e.next=19,this.keyManager.storeKey({level:exports.KeyManagerLevel.PASSWORD,privateKey:o,challenge:n});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.savePIN=function(){var e=l(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.keyManager.generateRandomPrivateKey(),e.next=3,this.keyManager.storeKey({level:exports.KeyManagerLevel.PIN,privateKey:r,challenge:t});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.checkPin=function(){var e=l(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyManager.checkKey({level:exports.KeyManagerLevel.PIN,challenge:t});case 2:return e.sent||K("Pin is incorrect",exports.SdkErrors.PinInValid),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.saveFingerprint=function(){var e=l(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.keyManager.generateRandomPrivateKey(),e.next=3,this.keyManager.storeKey({level:exports.KeyManagerLevel.FINGERPRINT,privateKey:t});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.saveLocal=function(){var e=l(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.keyManager.generateRandomPrivateKey(),e.next=3,this.keyManager.storeKey({level:exports.KeyManagerLevel.LOCAL,privateKey:t});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.createPerson=function(){var e=l(f().mark((function e(){var r,n,o,a,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.keyManager,e.next=3,this.storage.username;case 3:return n=e.sent.usernameHash,e.next=7,r.getKey({level:exports.KeyManagerLevel.PASSWORD});case 7:return(o=e.sent)||K("Password key not found",exports.SdkErrors.KeyNotFound),a=t.PrivateKey.from("PVT_K1_2bfGi9rYsXQSXXTvJbDAPhHLQUojjaNLomdm3cEJ1XTzMqUt3V"),e.next=12,this.storage.salt;case 12:return s=e.sent,e.prev=13,e.next=16,Ae.newperson(n.toString(),o.toString(),s.toString(),q(a));case 16:i=e.sent,e.next=25;break;case 19:if(e.prev=19,e.t0=e.catch(13),!(e.t0 instanceof W)){e.next=24;break}if(!e.t0.hasErrorCode(3050003)||!e.t0.hasTonomyErrorCode("TCON1000")){e.next=24;break}throw K("Username is taken",exports.SdkErrors.UsernameTaken);case 24:throw e.t0;case 25:return this.storage.accountName=t.Name.from(i.processed.action_traces[0].inline_traces[0].act.data.name),e.next=29,this.storage.accountName;case 29:return this.storage.status=exports.UserStatus.CREATING_ACCOUNT,e.next=32,this.storage.status;case 32:return e.next=34,this.createDid();case 34:return e.abrupt("return",i);case 35:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(){return e.apply(this,arguments)}}(),r.updateKeys=function(){var e=l(f().mark((function e(t){var r,n,o,a,s,i,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStatus();case 2:if(e.sent!==exports.UserStatus.DEACTIVATED){e.next=5;break}throw new Error("Can't update keys ");case 5:return r=this.keyManager,e.next=8,r.getKey({level:exports.KeyManagerLevel.PIN});case 8:return n=e.sent,e.next=11,r.getKey({level:exports.KeyManagerLevel.FINGERPRINT});case 11:return o=e.sent,e.next=14,r.getKey({level:exports.KeyManagerLevel.LOCAL});case 14:return a=e.sent,s={},n&&(s.PIN=n.toString()),o&&(s.FINGERPRINT=o.toString()),a&&(s.LOCAL=a.toString()),i=G(r,exports.KeyManagerLevel.PASSWORD,t),e.next=22,this.storage.accountName;case 22:return u=e.sent,e.next=25,Ae.updatekeysper(u.toString(),s,i);case 25:return this.storage.status=exports.UserStatus.READY,e.next=28,this.storage.status;case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.checkPassword=function(){var t=l(f().mark((function t(r){var n,o,a,s,i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountName();case 2:return n=t.sent,t.next=5,Ae.getPerson(n);case 5:return a=(o=t.sent).password_salt,t.next=9,this.savePassword(r,{salt:a});case 9:return t.next=11,this.keyManager.getKey({level:exports.KeyManagerLevel.PASSWORD});case 11:return s=t.sent,t.next=14,e.getAccountInfo(o.account_name);case 14:return i=t.sent.getPermission("owner").required_auth.keys[0].key,s||K("Password key not found",exports.SdkErrors.KeyNotFound),s.toString()!==i.toString()&&K("Password is incorrect",exports.SdkErrors.PasswordInValid),t.abrupt("return",!0);case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.login=function(){var r=l(f().mark((function r(n,o){var a,s,i,u,c;return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=this.keyManager,r.next=3,Ae.getPerson(n);case 3:return i=(s=r.sent).password_salt,r.next=7,this.savePassword(o,{salt:i});case 7:return r.next=9,a.getKey({level:exports.KeyManagerLevel.PASSWORD});case 9:return(u=r.sent)||K("Password key not found",exports.SdkErrors.KeyNotFound),r.next=13,e.getAccountInfo(s.account_name);case 13:return c=r.sent.getPermission("owner").required_auth.keys[0].key,u.toString()!==c.toString()&&K("Password is incorrect",exports.SdkErrors.PasswordInValid),this.storage.accountName=t.Name.from(s.account_name),this.storage.username=n,this.storage.status=exports.UserStatus.LOGGING_IN,r.next=21,this.storage.accountName;case 21:return r.next=23,this.storage.username;case 23:return r.next=25,this.storage.status;case 25:return r.next=27,this.createDid();case 27:return r.abrupt("return",s);case 28:case"end":return r.stop()}}),r,this)})));return function(e,t){return r.apply(this,arguments)}}(),r.checkKeysStillValid=function(){var t=l(f().mark((function t(){var r,n,o,a,s,i,u;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.storage.status!==exports.UserStatus.READY&&K("User is not ready",exports.SdkErrors.AccountDoesntExist),t.t0=e,t.next=4,this.storage.accountName;case 4:return t.t1=t.sent,t.next=7,t.t0.getAccountInfo.call(t.t0,t.t1);case 7:r=t.sent,n=[{level:exports.KeyManagerLevel.PIN,permission:"pin"},{level:exports.KeyManagerLevel.FINGERPRINT,permission:"fingerprint"},{level:exports.KeyManagerLevel.LOCAL,permission:"local"},{level:exports.KeyManagerLevel.PASSWORD,permission:"active"},{level:exports.KeyManagerLevel.PASSWORD,permission:"owner"}],o=0,a=n;case 10:if(!(o<a.length)){t.next=30;break}return s=a[o],i=void 0,t.prev=13,t.next=16,this.keyManager.getKey({level:s.level});case 16:i=t.sent,t.next=22;break;case 19:t.prev=19,t.t2=t.catch(13),i=null;case 22:u=void 0;try{u=r.getPermission(s.permission)}catch(e){u=null}!i&&u&&K(s.level+" key was not found in the keyManager, but was found on the blockchain",exports.SdkErrors.KeyNotFound),i&&!u&&K(s.level+" keys was not found on the blockchain, but was found in the keyManager",exports.SdkErrors.KeyNotFound),i&&u&&i.toString()!==u.required_auth.keys[0].key.toString()&&K(s.level+" keys do not match",exports.SdkErrors.KeyNotFound);case 27:o++,t.next=10;break;case 30:return t.abrupt("return",!0);case 31:case"end":return t.stop()}}),t,this,[[13,19]])})));return function(){return t.apply(this,arguments)}}(),r.logout=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyManager.removeKey({level:exports.KeyManagerLevel.PASSWORD});case 2:return e.next=4,this.keyManager.removeKey({level:exports.KeyManagerLevel.PIN});case 4:return e.next=6,this.keyManager.removeKey({level:exports.KeyManagerLevel.FINGERPRINT});case 6:return e.next=8,this.keyManager.removeKey({level:exports.KeyManagerLevel.LOCAL});case 8:this.storage.clear(),this.communication.disconnect();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.isLoggedIn=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStatus();case 2:return e.t0=e.sent,e.t1=exports.UserStatus.READY,e.abrupt("return",e.t0===e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.getAccountInfo=function(){var e=l(f().mark((function e(t){var r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M();case 3:if(n=e.sent,!(t instanceof ie)){e.next=11;break}return e.next=7,Ae.getPerson(t);case 7:r=e.sent.account_name,e.next=12;break;case 11:r=t;case 12:return e.next=14,n.v1.chain.get_account(r);case 14:return e.abrupt("return",e.sent);case 17:if(e.prev=17,e.t0=e.catch(0),"Account not found at /v1/chain/get_account"!==e.t0.message){e.next=24;break}K('Account "'+t.toString()+'" not found',exports.SdkErrors.AccountDoesntExist),e.next=25;break;case 24:throw e.t0;case 25:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=l(f().mark((function e(t,r){var n,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ae(this.keyManager,exports.KeyManagerLevel.LOCAL),e.next=3,this.getDid();case 3:return e.t0=e.sent,e.t1=e.t0+"#local",e.t2=n.sign,o={did:e.t1,signer:e.t2,alg:"ES256K-R"},e.next=9,be.sign(t,o,r);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.createDid=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.chainID){e.next=4;break}return e.next=3,j();case 3:this.chainID=e.sent.chain_id;case 4:return e.next=6,this.storage.accountName;case 6:return this.storage.did="did:antelope:"+this.chainID+":"+e.sent.toString(),e.next=10,this.storage.did;case 10:return e.abrupt("return",this.storage.did);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.intializeFromStorage=function(){var e=l(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccountName();case 2:if(!(t=e.sent)){e.next=9;break}return e.next=6,this.checkKeysStillValid();case 6:return e.abrupt("return",e.sent);case 9:K('Account "'+t+'" not found',exports.SdkErrors.AccountDoesntExist);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}(),Oe=function(){function e(e,t,r,n){this.threshold=e,this.keys=t,this.accounts=r,this.waits=n}return e.fromKey=function(e){return new this(1,[{key:e,weight:1}],[],[])},e.fromAccount=function(e){return new this(1,[],[{permission:e,weight:1}],[])},e.prototype.addCodePermission=function(e){this.accounts.push({permission:{actor:e,permission:"eosio.code"},weight:1})},e}(),_e=function(){function e(){}var r=e.prototype;return r.deployContract=function(){var e=l(f().mark((function e(r,n,o,a){var s,i,u,c,p,h,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.toString("hex"),i=JSON.parse(o),u=t.ABI.from(i),c=t.Serializer.encode({object:u}).hexString,p={account:"eosio",name:"setcode",authorization:[{actor:r.toString(),permission:"active"}],data:{account:r.toString(),vmtype:0,vmversion:0,code:s}},h={account:"eosio",name:"setabi",authorization:[{actor:r.toString(),permission:"active"}],data:{account:r,abi:c}},l=[p,h],e.next=9,z(t.Name.from("eosio"),l,a);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,o){return e.apply(this,arguments)}}(),r.newaccount=function(){var e=l(f().mark((function e(r,n,o,a,s){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={authorization:[{actor:r,permission:"active"}],account:"eosio",name:"newaccount",data:{creator:r,name:n,owner:o,active:a}},e.next=3,z(t.Name.from("eosio"),[i],s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a){return e.apply(this,arguments)}}(),r.updateauth=function(){var e=l(f().mark((function e(r,n,o,a,s){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={authorization:[{actor:r,permission:o}],account:"eosio",name:"updateauth",data:{account:r,permission:n,parent:o,auth:a}},e.next=3,z(t.Name.from("eosio"),[i],s);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a){return e.apply(this,arguments)}}(),v(e,null,[{key:"Instance",get:function(){return this.singletonInstance||(this.singletonInstance=new this)}}]),e}(),Re=function(){function e(){}var r=e.prototype;return r.create=function(){var e=l(f().mark((function e(r,n){var o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[{account:"eosio.token",name:"create",authorization:[{actor:"eosio.token",permission:"active"}],data:{issuer:"eosio.token",maximum_supply:r}}],e.next=3,z(t.Name.from("eosio.token"),o,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.issue=function(){var e=l(f().mark((function e(r,n){var o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[{account:"eosio.token",name:"issue",authorization:[{actor:"eosio.token",permission:"active"}],data:{to:"eosio.token",quantity:r,memo:""}}],e.next=3,z(t.Name.from("eosio.token"),o,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),v(e,null,[{key:"Instance",get:function(){return this.singletonInstande||(this.singletonInstande=new this)}}]),e}(),Le=function(){function e(e){this._storage={},this.scope=e,this._storage={}}var t=e.prototype;return t.retrieve=function(){var e=l(f().mark((function e(t){var r,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this._storage)){e.next=2;break}return e.abrupt("return",this._storage[t]);case 2:if(!localStorage){e.next=10;break}if(!(r=localStorage.getItem(t))){e.next=8;break}return n=JSON.parse(r),this._storage[t]=n,e.abrupt("return",n);case 8:e.next=11;break;case 10:return e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.store=function(){var e=l(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage&&localStorage.setItem(t,JSON.stringify(r)),this._storage[t]=r;case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t.clear=function(){var e=l(f().mark((function e(){var t,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._storage={},localStorage)for(t=0;t<localStorage.length;t++)"string"==typeof(r=localStorage.key(t))&&r.startsWith(this.scope)&&localStorage.removeItem(r);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}();function Ke(e){return new Le(e)}var Ie=function(){function e(e,t){this.keyManager=e,this.storage=Y("tonomy.externalUser.",t)}e.getUser=function(){var t=l(f().mark((function t(r,n){var o,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=Ke),o=new e(r,n),t.prev=2,t.next=5,o.getAccountName();case 5:if(a=t.sent){t.next=8;break}throw K("accountName not found",exports.SdkErrors.AccountNotFound);case 8:return t.next=10,Ee.verifyKeyExistsForApp(a.toString(),r);case 10:if(!t.sent){t.next=15;break}return t.abrupt("return",o);case 15:throw K("User Not loggedIn",exports.SdkErrors.UserNotLoggedIn);case 16:t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(2),o.storage.clear(),t.t0;case 22:case"end":return t.stop()}}),t,null,[[2,18]])})));return function(e,r){return t.apply(this,arguments)}}();var r=e.prototype;return r.getDid=function(){var e=l(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.did_){e.next=10;break}return e.next=3,this.getAccountName();case 3:return e.next=5,e.sent.toString();case 5:return t=e.sent,e.next=8,j();case 8:this.did_="did:antelope:"+e.sent.chain_id+":"+t+"#local";case 10:return e.abrupt("return",this.did_);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.setAccountName=function(){var e=l(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storage.accountName=t,e.next=3,this.storage.accountName;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.setUsername=function(){var e=l(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storage.username=new ie(t),e.next=3,this.storage.username;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getUsername=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.username;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.setLoginRequest=function(){var e=l(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storage.loginRequest=t,e.next=3,this.storage.loginRequest;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.getLoginRequest=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.loginRequest;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getAccountName=function(){var e=l(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.accountName;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.loginWithTonomy=function(){var e=l(f().mark((function e(t,r){var n,o,s,i,u,c,p,h,l,d,v;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=void 0===(n=t.redirect)||n,s=t.callbackPath,i=oe(),u=i.privateKey,c=i.publicKey,!r){e.next=5;break}return e.next=5,r.storeKey({level:exports.KeyManagerLevel.BROWSER_LOCAL_STORAGE,privateKey:u});case 5:return p={randomString:ee(32),origin:window.location.origin,publicKey:c.toString(),callbackPath:s},h=a.ES256KSigner(u.data.array,!0),e.next=9,ye(c);case 9:return l=xe(e.sent),e.next=13,be.sign(p,{did:l,signer:h,alg:"ES256K-R"});case 13:if(d=e.sent.jwt,v=JSON.stringify([d]),!o){e.next=19;break}return window.location.href=C().ssoWebsiteOrigin+"/login?requests="+v,e.abrupt("return");case 19:return e.abrupt("return",d);case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.signMessage=function(){var e=l(f().mark((function e(t,r,n){var o,a,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=exports.KeyManagerLevel.BROWSER_LOCAL_STORAGE,e.next=3,r.getKey({level:o});case 3:if(a=e.sent){e.next=6;break}throw K("No Key Found for this level",exports.SdkErrors.KeyNotFound);case 6:return s=ae(r,o).sign,e.next=9,ye(a);case 9:return i=xe(e.sent),e.next=13,be.sign(t,{did:i,signer:s,alg:"ES256K-R"},n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),e.verifyLoginRequest=function(){var r=l(f().mark((function r(n){var o,a,s,i,u,c,p,h;return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.checkKeys||(n.checkKeys=!0),s=Ee.getLoginRequestParams(),i=s.requests,u=s.username,c=s.accountName,r.next=4,Ee.verifyRequests(i);case 4:return(p=null==(o=r.sent.find((function(e){return e.getPayload().origin===window.location.origin})))?void 0:o.getPayload())||K("No login request found for this origin",exports.SdkErrors.OriginMismatch),r.t0=p.publicKey,r.next=10,n.keyManager.getKey({level:exports.KeyManagerLevel.BROWSER_LOCAL_STORAGE});case 10:if(r.t1=a=r.sent,null!=r.t1){r.next=15;break}r.t2=void 0,r.next=16;break;case 15:r.t2=a.toString();case 16:if(r.t3=r.t2,r.t0===r.t3){r.next=19;break}K("Key in request does not match",exports.SdkErrors.KeyNotFound);case 19:if(!n.checkKeys){r.next=24;break}return r.next=22,Ee.verifyKeyExistsForApp(c,n.keyManager);case 22:r.sent||K("Key not found",exports.SdkErrors.KeyNotFound);case 24:return h=new e(n.keyManager,n.storageFactory||Ke),r.next=28,h.setAccountName(t.Name.from(c));case 28:return r.next=30,h.setLoginRequest(p);case 30:return r.next=32,h.setUsername(u);case 32:return r.abrupt("return",h);case 33:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),e}(),Te=m({},U,B);Object.defineProperty(exports,"ES256KSigner",{enumerable:!0,get:function(){return a.ES256KSigner}}),Object.defineProperty(exports,"createSigner",{enumerable:!0,get:function(){return c.createSigner}}),exports.App=le,exports.Authority=Oe,exports.BrowserStorage=Le,exports.Communication=Ne,exports.EosioContract=_e,exports.EosioTokenContract=Re,exports.EosioUtil=Te,exports.ExternalUser=Ie,exports.HttpError=_,exports.IDContract=ue,exports.Message=be,exports.SdkError=R,exports.TonomyUsername=ie,exports.User=Pe,exports.UserApps=Ee,exports.browserStorageFactory=Ke,exports.createSdkError=L,exports.createStorage=Y,exports.createUserObject=function(e,t){return new Pe(e,t)},exports.createVCSigner=ae,exports.decodeHex=function(e){return e.split(/(\w\w)/g).filter((function(e){return!!e})).map((function(e){return String.fromCharCode(parseInt(e,16))})).join("")},exports.encodeHex=ne,exports.generateRandomKeyPair=oe,exports.getSettings=C,exports.int2hex=re,exports.randomBytes=Z,exports.randomString=ee,exports.setSettings=function(e){O=e,T=!0},exports.sha256=te,exports.storageProxyHandler=H,exports.throwError=K,exports.toElliptic=$;
//# sourceMappingURL=tonomy-id-sdk.cjs.production.min.js.map
